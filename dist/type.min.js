/*! typejs v0.1.0 */
!function(){"use strict";function a(a){if(f(a))return a;var b=[];return c(a,function(a){b.push(a)}),b}function b(a,b){for(var c=0;c<a.length&&b.call(void 0,a[c],c)!==!1;c++);}function c(a,b){for(var c in a)if(j(a,c)&&b.call(void 0,a[c],c)===!1)break}function d(a){return null===a?"null":void 0===a?"undefined":Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}function e(a){return"function"===d(a)}function f(a){return"array"===d(a)}function g(a){return"string"===d(a)}function h(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function i(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)j(a,c)&&b.push(c);return b}function j(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function k(a,c){if(a.indexOf)return a.indexOf(c);var d=-1;return b(a,function(a,b){return a===c?(d=b,!1):void 0}),d}function l(a){if("object"!==d(a)||a.nodeType||"window"===d(a))return!1;try{if(a.constructor&&!j(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function m(c,d,e){if(c=a(c),Array.prototype.map)return c.map(d,e);var f=[];b(c,function(a,b){f.push(d.call(e,a,b))})}function n(){return m(arguments,function(a,b){return 0===b?a.replace(/\/$/,""):a.replace(/(^\/|\/$)/g,"")}).join("/")}function o(a,b){return function(){return a.apply(b,arguments)}}function p(a,b){return b?a():void 0}function q(a,b,c){if(void 0===c.enumerable&&(c.enumerable=!0),u&&delete c.enumerable,void 0===c.configurable&&(c.configurable=!0),u&&j(a,b)&&delete a[b],!Object.defineProperty)throw t("InitializationError","JavaScript properties are not supported by this browser.");Object.defineProperty(a,b,c)}function r(a){return this instanceof r?(this.value=a,void 0):new r(a)}function s(a){return this instanceof s?(this.value=a,void 0):new s(a)}var t=function(){var a={Error:Error,TypeError:TypeError};return function(b,c){if(!a[b]){var d=function(a){this.message=a};d.prototype=new a.Error,d.prototype.name=b,a[b]=d}return c?new a[b](c):a[b]}}(),u=function(){try{return Object.defineProperty({},"x",{}),!1}catch(a){return!0}}(),v="public",w="private",x="protected",y="ctor",z=function(){if(global.setImmediate)return global.setImmediate;var a=[],b="zero-timeout-message",c=function(c){a.push(c),window.postMessage(b,"*")},d=function(c){c.source===window&&c.data===b&&(c.stopPropagation(),a.length>0&&a.shift()())};return window.addEventListener("message",d,!0),c}(),A=function(a){a=a||{},e(a)&&(a=a());var b="default",c=function(){if("new"===b)return b="void",new c;if("void"!==b){b="new";var a=c();b="default";var g=a.ctor.apply(a,arguments);return e(g)||f(g)||"object"===d(g)?g:a}};return a.ctor||(a.ctor=function(){}),c.prototype=a,c},B=function(){function a(a,b,c){for(var e=[{src:c,tmpl:b,dest:a}];e.length;){var f=e.shift();if(f.array)for(var g=0;g<f.array.length;g++)switch(d(f.array[g])){case"object":var h=f.array[g];f.array[g]={},e.push({tmpl:h,dest:f.array[g]});break;case"array":f.array[g]=f.array[g].slice(0),e.push({array:f.array[g]})}else for(var i in f.tmpl)if(void 0!==f.src[i])f.dest[i]=f.src[i];else switch(d(f.tmpl[i])){case"object":f.dest[i]={},e.push({tmpl:f.tmpl[i],dest:f.dest[i]});break;case"array":f.dest[i]=f.tmpl[i].slice(0),e.push({array:f.dest[i]});break;default:f.dest[i]=f.tmpl[i]}}}return function(b){var c="default",d=function(e){if("new"===c)return c="void",new d;if("void"!==c){c="new";var f=d();return c="default",a(f,b,e||{}),f}};return d}}(),C=new A({ctor:function(){this.keys=[],this.values=[]},add:function(a,b){k(this.keys,a)>-1||(this.keys.push(a),this.values.push(b))},remove:function(a){var b=k(this.keys,a);b>-1&&(this.keys.splice(b,1),this.values.splice(b,1))},get:function(a){var b=k(this.keys,a);return b>-1?this.values[b]:null},set:function(a,b){var c=k(this.keys,a);c>-1&&(this.values[c]=b)},contains:function(a){return k(this.keys,a)>-1}}),D=function(a){return a.valueOf=function(){return D.operands.push(this),3},a};D.operands=[];var E=new A({ctor:function(){this._pending={},this._cache={},this._browser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),this._last=null,M=o(this._onTypeDefined,this)},fetch:function(a){var b=new F;if(this._browser){var c=a.url;if(c=/^\/\//.test(c)?window.location.protocol+c:/^\//.test(c)?window.location.protocol+"//"+window.location.host+c:window.location.protocol+"//"+window.location.host+window.location.pathname+c,this._cache[c])b.resolve(this._cache[c]);else if(this._pending[c])this._pending[c].bind(b);else{var d=document.createElement("script");d.src=c,d.addEventListener("error",function(){b.reject()},!1),document.body.appendChild(d),this._pending[c]=b}}else this._last=b,require(a.url);return b.promise},_onTypeDefined:function(a){if(this._browser){var b=document.getElementsByTagName("script"),c=b[b.length-1].src;if(this._pending[c]){this._cache[c]=a;var d=this._pending[c];delete this._pending[c],setTimeout(function(){d.resolve(a)})}}else if(null!==this._last){var d=this._last;this._last=null,d.resolve(a)}}}),F=new A(function(){function a(b,c){if(c===b)return b.reject(new TypeError("2.3.1 A promise returned from onFulfilled cannot refer to itself.")),!0;if(c){var d,f=!1;try{j(c,"then")&&(d=c.then)}catch(g){return b.reject(g),!0}if(e(d)){try{d.call(c,function(c){f||(f=!0,a(b,c)||b.resolve(c))},function(a){f||(f=!0,b.reject(a))})}catch(g){f||b.reject(g)}return!0}}}function b(b,c,f){var g=function(g,h){var i,j=g===d?c:f;if(!e(j))return g===d?b.resolve(h):b.reject(h),void 0;try{i=j.call(void 0,h)}catch(k){return b.reject(k),void 0}a(b,i)||b.resolve(i)};return function(){var a=arguments;z(function(){g.apply(void 0,a)})}}var c="pending",d="fulfilled",f="rejected";return{ctor:function(a){function e(a,b){if(h===c){h=a,j=b;for(var d=0;d<i.length;d++)i[d](h,j);i=[]}}var g=this,h=c,i=[],j=null;this.then=function(a,d){var e=new F,f=b(e,a,d);return h===c?i.push(f):f(h,j),e},this.resolve=function(a){return e(d,a),this},this.reject=function(a){return e(f,a),this},this.promise={then:this.then},a&&z(function(){a.call(void 0,g.resolve,g.reject)})},splat:function(a,b){return this.then(function(b){return a.apply(void 0,b)},b)}}});F.when=function(c){c=f(c)?c:a(arguments);var d=new F,e=0,g=[];return b(c,function(a,b){a.then(function(a){g[b]=a,++e===c.length&&d.resolve(g)},function(a){d.reject(a)})}),c.length||d.resolve([]),d.promise};var G=new B({access:null,method:null,callsuper:!1}),H=new A({ctor:function(){this.controller=null,this.tunnel=null},init:function(a,b,c,d){var e=this,f=this.controller.createScope(a);return q(f.self,"_pub",{get:function(){return b}}),this._build(f),this._expose(f,b),q(b,"__scope__",{enumerable:!1,get:function(){return e.tunnel.value()===a.ctor?f.self:void 0}}),d&&f.self.ctor.apply(f.self,c),p(function(){function b(c){null!==c.template.parent&&b(c.parent);for(var d=0;d<c.template.members.values.length;d++)c.template.members.values[d]instanceof O&&c.self[a.members.keys[d]]()}b(f)}),f.self},_build:function(a){for(var b=0;b<a.template.mixins.length;b++){var c=this.init(a.template.mixins[b],a.self._pub,[],!1);this._proxy(c,a),a.mixins.push(c)}if(null!==a.template.parent){if(a.template.parent.members.contains(y)&&a.template.parent.members.get(y).params.length>0&&(!a.template.members.contains(y)||!a.template.members.get(y).callsuper))throw t("InitializationError","Base constructor contains parameters and must be called explicitly.");a.parent=this.controller.createScope(a.template.parent),a.parent.self._pub=a.self._pub,this._build(a.parent)}null!==a.template.parent&&this._proxy(a.parent,a);for(var d=0;d<a.template.members.values.length;d++)a.template.members.values[d].build(a);if(!a.self.ctor){var e=new O;e.name=y,e.access=w,e.method=function(){},e.build(a)}},_proxy:function(a,b){for(var c=0;c<a.template.members.values.length;c++){var d=a.template.members.values[c];if(d.access!==w&&!b.template.members.get(d.name))if(d instanceof O||d instanceof K)b.self[d.name]=a.self[d.name];else if(d instanceof P){var e={};d.get&&d.get.access!==w&&(e.get=function(){return a.self[d.name]}),d.set&&d.set.access!==w&&(e.set=function(b){a.self[d.name]=b}),q(b.self,d.name,e)}}},_expose:function(a,b){null!==a.template.parent&&this._expose(a.parent,b);for(var c=0;c<a.template.members.values.length;c++){var d=a.template.members.values[c];if(d.access===v)if(d instanceof O)b[d.name]=a.self[d.name];else if(d instanceof K)q(b,d.name,{get:function(){return a.self[d.name]},set:function(b){a.self[d.name]=b}});else if(d instanceof P){var e={};d.get&&d.get.access===v&&(e.get=function(){return a.self[d.name]}),d.set&&d.set.access===v&&(e.set=function(b){a.self[d.name]=b}),q(b,d.name,e)}}}}),I=new A({ctor:function(){this.tunnel=null,this.builder=null,this._checkTypeOurs=!1,this._typeCheckResult=!1,this._returnScope=!1,this._returnBase=!1,this._returnTemplate=!1},isTypeOurs:function(a){this._checkTypeOurs=!0,a();var b=this._typeCheckResult;return this._typeCheckResult=!1,this._checkTypeOurs=!1,b},createScope:function(a){this._returnScope=!0;var b=a.ctor();return this._returnScope=!1,b},createEmpty:function(a){this._returnBase=!0;var b=new a.ctor;return this._returnBase=!1,b},getTemplate:function(a){this._returnTemplate=!0;var b=a();return this._returnTemplate=!1,b},createTemplate:function(){var a=this,b=null,c=new R,d=!0,e=function(){if(!a._returnBase){if(a._checkTypeOurs)return a._typeCheckResult=!0,void 0;if(a._returnScope){null===b&&(b=a._createSelf(c));var f=new Q;return f.template=c,u?(f.self=a._createElement(),a._applyPrototype(b,f.self)):f.self=new b,f}if(a._returnTemplate)return c;if(d){var g;return d=!1,u?(g=a._createElement(),a._applyPrototype(c.ctor,g)):g=new e,a.builder.init(c,g,arguments,!0),d=!0,g}}};return c.ctor=e,c.members=new C,c},_applyPrototype:function(a,b){var c=a.prototype;c.constructor.prototype!==c&&this._applyPrototype(c.constructor,b);for(var d in c)j(c,d)&&(b[d]=c[d])},_createElement:function(){var a,b=document.createElement();for(a in b)j(b,a)&&this._resetProperty(b,a);return b},_resetProperty:function(a,b){var c;Object.defineProperty(a,b,{configurable:!0,get:function(){return c},set:function(a){c=a}})},_createSelf:function(a){var b=this,c=function(){};return c.prototype=this.createEmpty(a),c.prototype._pry=function(c){b.tunnel.open(a.ctor);var d=c&&c.__scope__?c.__scope__:null;return b.tunnel.close(),d||c},c}}),J=new A(function(){function a(a){var b=a.substr(0,2),c=m[b]||m[a[0]]||v,d=n[b]||n[a[0]]||!1;return a=a.substr(o[b]||o[a[0]]||0),a===y&&(c=w,d=!1),new N({access:c,virtual:d,name:a})}function b(a,b){if(c(a,b.name))throw t("DefinitionError","Member '"+b.name+"' is already defined.");if(b.access!==w&&null!==a.parent&&a.parent.members.get(b.name)&&a.parent.members.get(b.name).access!==b.access)throw t("DefinitionError","Cannot change access modifier of member '"+b.name+"' from "+a.parent.members.get(b.name).access+" to "+b.access+".")}function c(a,b,d){var e=a.members.get(b);return null===e||d&&e.access===w||d&&e.virtual?null!==a.parent?c(a.parent,b,!0):!1:!0}function g(a){var b=[],c=a.toString().match(/^function\s*\(([^())]+)\)/);if(null!==c)for(var d=c[1].split(","),e=0,f=d.length;f>e;e++)b.push(h(d[e]));var g=new O;return g.method=a,g.params=b,g.callsuper=r.test(a),g}function j(b,c,f){var g=new P;"object"!==d(f)?(g.value=f,f={}):g.value=f.value,void 0===g.value&&(g.value=null);for(var h=i(f),j=0,l=h.length;l>j;j++){var m=f[h[j]],n=a(h[j].toLowerCase());if("get"===n.name||"set"===n.name){if(n.virtual)throw t("DefinitionError","Property '"+c.name+"' cannot have virtual accessors.");if(null!==m&&!e(m))throw t("TypeError","The "+n.name+" accessor for property '"+c.name+"' must be a function or null (uses default implementation.)");g[n.name]=new G({access:n.access,method:m})}}return g.get||g.set||(g.get=new G({access:c.access}),g.set=new G({access:c.access})),g.get&&null===g.get.method&&(g.get.method=function(){return this._value()}),g.set&&null===g.set.method&&(g.set.method=function(a){this._value(a)}),k(g),g.get.callsuper=r.test(g.get.method),g.set.callsuper=r.test(g.set.method),g}function k(a,b){for(var c=["get","set"],d=0,e=0,f=c.len;f>e;e++){var g=c[e],h=b[g];if(null!==h){var i=null!==a.parent?a.parent.members.get(b.name):null;if(null!==i&&i.access!==w&&null===i[g])throw t("DefinitionError","Cannot change read/write definition of property '"+b.name+"'.");if(q[h.access]<q[b.access])throw t("DefinitionError","The "+g+" accessor of the property '"+b.name+"' cannot have a higher visibility than the property itself.");if(h.access!==b.access&&d++,h.access!==i.access)throw t("DefinitionError","Cannot change access modifier of '"+g+"' accessor for property '"+b.name+"' from "+i.access+" to "+h.access+".")}}if(2===d)throw t("DefinitionError","Cannot set access modifers for both accessors of the property '"+b.name+"'.")}function l(a,b){if(a===b)throw t("DefinitionError","Cannot include type that includes self.");for(var c=0,d=b.mixins.length;d>c;c++)l(a,b.mixins[c])}var m={__:w,_:x},n={$:!0,_$:!0},o={__:2,_$:2,_:1,$:1},q={};q[v]=1,q[x]=2,q[w]=3;var r=/xyz/.test(function(){xyz=0})?/\b_super\b/:/.*/;return{ctor:function(){this.controller=null},defineParent:function(a,b){if(a.members.keys.length>0)throw t("DefinitionError","Cannot change the parent type after members have been defined.");if(!e(b))throw t("TypeError","Parent type must be a function.");if(this.controller.isTypeOurs(b)){for(var c=this.controller.getTemplate(b),d=c;d;){if(d===a)throw t("DefinitionError","Cannot inherit from "+(c===a?"self":"derived type")+".");d=d.parent}a.parent=c,a.ctor.prototype=this.controller.createEmpty(c)}else a.ctor.prototype=new b},defineMembers:function(d,h){for(var k=i(h||{}),l=0,m=k.length;m>l;l++){var n=a(k[l]),o=h[k[l]];if(b(d,n),p(function(){return c(d,n.name)}))return;if(n.name===y&&(f(o)&&(d.ctor.$inject=o,o=o.pop()),!e(o)))throw t("TypeError","Member '"+y+"' must be a function.");var q=e(o)?g(o):j(o);if(n.name===y&&!q.callsuper&&null!==d.parent){var r=d.parent.members.get(y);if(null!==r&&r.params.length>0)throw t("DefinitionError","Constructor must call the parent constructor explicitly because it contains parameters.")}q.name=n.name,q.access=n.access,q.virtual=n.virtual,d.members.add(n.name,q)}},defineEvents:function(c,d){for(var e=0,f=d.length;f>e;e++){var g=a(d[e]);if(b(c,g),g.name===y)throw t("DefinitionError","Event cannot be named 'ctor'.");if(g.virtual)throw t("DefinitionError","Events cannot be virtual.");var h=new K;h.name=g.name,h.access=g.access,c.members.add(g.name,h)}},defineMixins:function(a,b){if(a.members.contains(y))throw t("DefinitionError","Mixins must be defined before the constructor.");for(var c=0,d=b.length;d>c;c++){if(!this.controller.isTypeOurs(b[c]))throw t("TypeError","Mixin must be a type.");if(b[c]===a.ctor)throw t("DefinitionError","Cannot include self.");l(a.ctor,b[c]),a.mixins.push(b[c])}}}}),K=new A({ctor:function(){this.name=null,this.access=null,this.virtual=!1},build:function(a){function b(a){d.push(a)}function c(a){var b=k(d,a);b>-1&&d.splice(b,1)}var d=[],e=new D(function(){for(var a=0,b=d.length;b>a;a++)d[a].apply(void 0,arguments)});q(a.self,this.name,{get:function(){return e},set:function(a){if(2===D.operands.length&&D.operands[0]===e){var d=D.operands[1];6===a?b(d):0===a&&c(d)}}})}}),L=function(){};L.prototype.build=function(){},L.prototype.name=null,L.prototype.access=null,L.prototype.virtual=!1;var M,N=new B({access:null,virtual:!1,name:null}),O=new A({ctor:function(){this.callsuper=!1,this.params=[],this.access=null,this.virtual=!1,this.name=null,this.method=null},build:function(a){if(this.name===y)this._buildConstructor(a);else if(null!==a.parent&&a.parent.self[this.name]){var b=a.parent.self[this.name];a.self[this.name]=function(){var c=a.self._super;a.self._super=b;var d=member.method.apply(a.self,arguments);return void 0===c?delete a.self._super:a.self._super=c,d}}else a.self[this.name]=function(){return member.method.apply(a.self,arguments)};a.self[this.name]=new D(a.self[this.name])},_buildConstructor:function(b){b.self.ctor=function(){delete b.self.ctor;for(var c=[],d={_init:b.self._init,_super:b.self._super},e=0;e<b.template.mixins.length;e++){var f=b.template.mixins[e];f.members.contains(y)&&(f.members.get(y).params.length>0?c.push(f):f.members.get(y).method.call(b.mixins[e]))}if(c.length>0&&(b.self._init=function(d){var e=k(c,d);if(-1===e)throw t("InitializationError","Mixin is not defined for this type or has already been initialized.");var f=a(arguments);f.shift(),d.members.get(y).method.apply(b.mixins[k(b.template.mixins,d)],f),c.splice(e,1)}),null!==b.template.parent&&b.template.parent.members.contains(y)&&(b.template.parent.members.get(y).params.length>0?b.self._super=b.parent.self.ctor:b.parent.self.ctor()),member.method.apply(b.self,arguments),void 0===d._super?delete b.self._super:b.self._super=d._super,void 0===d._init?delete b.self._init:b.self._init=d._init,c.length>0)throw t("InitializationError","Some mixins were not initialized. Please make sure the constructor calls this._init() for each mixin having parameters in its constructor.")}}}),P=new A({ctor:function(){this.name=null,this.access=null,this.virtual=!1,this.value=null,this.get=null,this.set=null},build:function(a){function b(b,d){return function(){var e={_super:a.self._super,_value:a.self._value};a.self._super=d,a.self._value=function(a){return arguments.length&&(c=a),c};var f=b.apply(a.self,arguments);return void 0===e._super?delete a.self._super:a.self._super=e._super,void 0===e._value?delete a.self._value:a.self._value=e._value,f}}var c=this.value,d={};this.get&&(d.get=b(this.get.method,null===a.parent?null:function(){return a.parent.self[this.name]})),this.set&&(d.set=b(this.set.method,null===a.parent?null:function(b){a.parent.self[this.name]=b})),q(a.self,this.name,d)}}),Q=new B({parent:null,self:null,mixins:[],template:null}),R=new B({members:null,parent:null,mixins:[],ctor:null}),S=new A({ctor:function(){this._value=null},open:function(a){this._value=a},close:function(){this._value=null},value:function(){return this._value}}),T=function(){var b=new H,c=new I,d=new S,f=new J;return b.controller=c,b.tunnel=d,c.builder=b,c.tunnel=d,f.controller=c,function(){var b=c.createTemplate(),d=a(arguments);if(e(d[0])){var g=function(c,d){return function(){return c.apply(f,[b].concat(a(arguments))),d}},h={extend:g(f.defineParent,h),include:g(f.defineMixins,h),events:g(f.defineEvents,h),members:g(f.defineMembers,h)};d[0].call(h)}else 2===d.length&&(d[0].extend&&f.defineParent(b,d[0].extend),d[0].include&&f.defineMixins(b,d[0].include),d[0].events&&f.defineEvents(b,d[0].events)),d.length>0&&f.defineMembers(b,d[1]||d[0]);return M&&M(T),p(b.ctor),b.ctor}}(),U=new B({create:function(){},inject:[],filter:[]}),V=new T({ctor:function(a){this.binding=a},asSingleton:function(){var a,b=this.binding.create,c=!1;return this.binding.create=function(){return c||(a=b.apply(void 0,arguments),c=!0),a},this._pub},whenFor:function(a){if(!f(a)||!a.length)throw t("ArgumentError","Expected 'services' to be an array of string.");return this.binding.filter=a.slice(0),this._pub}}),W=new A({ctor:function(a,b){this._cookbook=a,this._handlers=[],this.missing=[],this.component=null;var c=b instanceof _?b:this._cookbook.search(b);if(null!==c)this.component=this._prepare(c);else{this.missing.push(b);var d=this;this._onUpdate(b,function(a){d.component=a})}},update:function(a){this.missing.splice(0);for(var b=this._handlers.slice(0),c=0;c<b.length;c++)b[c](a)},_prepare:function(a){for(var b=new Y(a),c=[b];c.length;){var d=c.shift();if(!d.recipe.lazy)for(var e=0;e<d.recipe.ingredients.length;e++){var f=d.recipe.ingredients[e],a=this._cookbook.search(f,d.recipe.name);if(a){var g=new Y(a);g.parent=d,g.order=e,d.children[e]=g,c.push(g)}else this.missing.push(f),this._onUpdate(f,function(a,b){return function(c){c.parent=a,c.order=b,a.children[e]=c}}(d,e))}}return b},_onUpdate:function(a,b){var c=this,d=a instanceof s,e=d||a instanceof r;(d||e)&&(a=a.value);var f=function(g){var h=g[a];if(h){var i=c._cookbook.search(h);i?(i.factory=e,i.lazy=d,b(c._prepare(i))):(c.missing.push(h),c._onUpdate(h,b)),c._handlers.splice(k(c._handlers,f),1)}};this._handlers.push(f)}}),X=new A({ctor:function(a,b){this._cookbook=a,this._loader=b},create:function(a){function b(){h=i._getRelativePaths(k.missing),i._loader()(h).then(c,g,!1)}function c(a){for(var c={},g=0;g<k.missing.length;g++){var i=k.missing[g].value||k.missing[g],l=a[g];if(!l||!/(string|function|array)/.test(d(l)))return j.reject(new TypeError("Module '"+h[g]+"' loaded successfully. Failed to resolve service '"+i+"'. Expected service to be a string, array, or function. Found '"+(l&&l.toString?l.toString():d(l))+"' instead.")),!1;if(f(l)&&!e(l[l.length-1]))return l=l[l.length-1],j.reject(new TypeError("Module '"+h[g]+"' loaded successfully. Failed to resolve service '"+i+"'. Found array. Expected last element to be a function. Found '"+(l&&l.toString?l.toString():d(l))+"' instead.")),!1;c[i]=a[g]}"rejected"!==j.state&&(k.update(c),k.missing.length?b():j.resolve(k.component))}function g(a){j.reject(a)}var h,i=this,j=new F,k=new W(this._cookbook,a);return k.missing.length?this._loader()?b():j.reject(new t("InvalidOperationError","Service(s) "+m(k.missing,function(a){return"'"+a+"'"}).join(", ")+" have not been registered.")):j.resolve(k.component),j.promise},createFactory:function(b){if(b.recipe.lazy)return this._createLazy(b);for(var c=this,d=[],e=b,f=[e];f.length;){var g=f.shift();if(d.push(g),!g.recipe.lazy)for(var h=0;h<g.children.length;h++)f.push(g.children[h])}return d.reverse(),d.pop(),function(){for(var b=0;b<d.length;b++){var f=d[b];f.parent.prep[f.order]=f.recipe.factory?c.createFactory(f):f.recipe.create.apply(void 0,f.prep),f.prep=[]}var g=e.prep.concat(a(arguments));return e.prep=[],e.recipe.create.apply(void 0,g)}},_createLazy:function(a){var b=this,c=null;return function(){var d=arguments;return c?(new F).resolve(c.apply(void 0,d)).promise:b.create(a.recipe.name).then(function(a){return c=b.createFactory(a),c.apply(void 0,d)},function(a){throw a},!1)}},_getRelativePaths:function(a){return m(a,function(a){return a instanceof r?a=a.value:a instanceof s&&(a=a.value),a.replace(/\./g,"/")})}}),Y=new A({ctor:function(a){this.parent=null,this.order=null,this.prep=[],this.recipe=a,this.children=[]}}),Z=new A({ctor:function(a){this._container=a},search:function(a,b){var c;return e(a)?new _({create:a,ingredients:(a.$inject||[]).slice(0)}):f(a)?(a=a.slice(0),new _({create:a.pop(),ingredients:a})):g(a)&&(c=this._lookup(a,b))?new _({create:c.create,ingredients:c.inject.slice(0),name:a}):a instanceof r&&(c=this._lookup(a.value,b))?new _({create:c.create,ingredients:c.inject.slice(0),name:a.value,factory:!0}):a instanceof s?(c=this._lookup(a.value,b)||{},new _({create:c.create||null,ingredients:c.inject?c.inject.slice(0):null,name:a.value,factory:!0,lazy:!0})):null},_lookup:function(a,b){for(var c=this._container[a]||[],d=c.length-1;d>=0;d--)if(b){if(!c[d].filter.length||k(c[d].filter,b)>-1)break}else if(!c[d].filter.length)break;return c[d]||null}}),$=new T(function(){var b=new T({ctor:function(a,b){this.kernel=a,this.service=b},to:function(a){return new V(this.kernel.register(this.service,a))},toConstant:function(a){return new V(this.kernel.register(this.service,function(){return a}))}}),d=new E;this.members({ctor:function(){this.container={},this.require=null;var a=this,b=new Z(this.container);this.chef=new X(b,function(){return a.require})},bind:function(a){if(!a||!g(a))throw t("ArgumentError","Argument 'service' must have a value.");return new b(this,a)},unbind:function(a,b){b=b||[];var c=this.container[a]||[],d=b.length;if(d){for(var e,f,g=0,h=c.length;h>g;g++){if(c[g].filter)for(e=0;d>e;e++)for(f=k(c[g].filter,b[e]);f>-1;)c[g].filter.splice(f,1),f=k(c[g].filter,b[e]);c[g].filter.length||(c.splice(g,1),g--)}c.length||delete this.container[a]}else delete this.container[a];return this._pub},resolve:function(b,c){var d=this;return c=a(arguments),c.shift(0),this.chef.create(b).then(function(a){var b=d.chef.createFactory(a);return a.recipe.factory?b:b.apply(void 0,c)},function(a){throw a})},autoBind:function(a){return this.registerGraph("",a),this._pub},autoLoad:function(a){if(a===!1)this.require=null;else{var b;e(a)?b=a:(g(a)&&(a={baseUrl:a}),a={baseUrl:a.baseUrl||"",waitSeconds:0===a.waitSeconds||a.waitSeconds?a.waitSeconds:7,urlArgs:a.urlArgs||"",scriptType:a.scriptType||"text/javascript"},b=function(b){var c=n(a.baseUrl,b);return/\.js$/.test(c)||(c+=".js"),d.fetch({url:c,timeout:1e3*a.waitSeconds,query:a.urlArgs,scriptType:a.scriptType})}),this.require=function(a){return F.when(m(a,function(a){var c=b(a);if(!c||!e(c.then))throw t("TypeError","Service loader must return a promise.");return c}))}}},__register:function(a,b){var c=null;if(f(b)){if(b=b.slice(0),c=new U({create:b.pop(),inject:b}),!e(c.create))throw t("ArgumentError","Expected last array element to be a function.")}else if(c=new U({create:b,inject:(b.$inject||[]).slice(0)}),!e(c.create))throw t("ArgumentError","Expected provider to be a function.");return this.container[a]=this.container[a]||[],this.container[a].push(c),c},__registerGraph:function(a,b){var d=this,e=""===a?"":a+".";c(b,function(a,b){l(a)?d.registerGraph(e+b,a):d.register(e+b,a)})}})}),_=new B({create:function(){},ingredients:[],name:null,factory:!1,lazy:!1}),ab={define:T,simple:A,struct:B,error:t,of:d,defer:F,kernel:$,factory:r,lazy:s};"undefined"!=typeof module&&module.exports?module.exports=ab:window.type=ab}();