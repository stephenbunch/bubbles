/*! typejs v0.1.0 */
!function(){"use strict";function a(a){if(f(a))return a;var b=[];return c(a,function(a){b.push(a)}),b}function b(a,b){if(Array.prototype.forEach)a.forEach(b);else for(var c=0,d=a.length;d>c&&b.call(void 0,a[c],c)!==!1;c++);}function c(a,b){for(var c in a)if(i(a,c)&&b.call(void 0,a[c],c)===!1)break}function d(a){return null===a?"null":void 0===a?"undefined":Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}function e(a){return"function"===d(a)}function f(a){return"array"===d(a)}function g(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function h(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)i(a,c)&&b.push(c);return b}function i(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function j(a,c){if(a.indexOf)return a.indexOf(c);var d=-1;return b(a,function(a,b){return a===c?(d=b,!1):void 0}),d}function k(a){if("object"!==d(a)||a.nodeType||"window"===d(a))return!1;try{if(a.constructor&&!i(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function l(c,d,e){if(c=a(c),Array.prototype.map)return c.map(d,e);var f=[];b(c,function(a,b){f.push(d.call(e,a,b))})}function m(){return l(arguments,function(a,b){return 0===b?a.replace(/\/$/,""):a.replace(/(^\/|\/$)/g,"")}).join("/")}function n(a,b){return function(){return a.apply(b,arguments)}}function o(a,b){return b?a():void 0}function p(a,b,c){if(void 0===c.enumerable&&(c.enumerable=!0),t&&delete c.enumerable,void 0===c.configurable&&(c.configurable=!0),t&&i(a,b)&&delete a[b],!Object.defineProperty)throw s("InitializationError","JavaScript properties are not supported by this browser.");Object.defineProperty(a,b,c)}function q(a){return this instanceof q?void(this.value=a):new q(a)}function r(a){return this instanceof r?void(this.value=a):new r(a)}var s=function(){function a(a,c){if(!b[a]){var d=function(a){this.message=a};d.prototype=new b.Error,d.prototype.name=a,b[a]=d}return c?new b[a](c):b[a]}var b={Error:Error,TypeError:TypeError};return function(){return a.apply(void 0,arguments)}}(),t=function(){try{return Object.defineProperty({},"x",{}),!1}catch(a){return!0}}(),u="public",v="private",w="protected",x="ctor",y=function(){if(global.setImmediate)return global.setImmediate;var a=[],b="zero-timeout-message",c=function(c){a.push(c),window.postMessage(b,"*")},d=function(c){c.source===window&&c.data===b&&(c.stopPropagation(),a.length>0&&a.shift()())};return window.addEventListener("message",d,!0),c}(),z=function(a){a=a||{},e(a)&&(a=a());var b="default",c=function(){if("new"===b)return b="void",new g;if("void"!==b){b="new";var a=g();b="default";var c=a.ctor.apply(a,arguments);return e(c)||f(c)||"object"===d(c)?c:a}},g=function(){return c.apply(void 0,arguments)};return a.ctor||(a.ctor=function(){}),g.prototype=a,g},A=function(){function a(a,b,c){for(var e=[{src:c,tmpl:b,dest:a}];e.length;){var f=e.shift();if(f.array)for(var g=0,h=f.array.length;h>g;g++)switch(d(f.array[g])){case"object":var i=f.array[g];f.array[g]={},e.push({tmpl:i,dest:f.array[g]});break;case"array":f.array[g]=f.array[g].slice(0),e.push({array:f.array[g]})}else for(var j in f.tmpl)if(void 0!==f.src[j])f.dest[j]=f.src[j];else switch(d(f.tmpl[j])){case"object":f.dest[j]={},e.push({tmpl:f.tmpl[j],dest:f.dest[j]});break;case"array":f.dest[j]=f.tmpl[j].slice(0),e.push({array:f.dest[j]});break;default:f.dest[j]=f.tmpl[j]}}}return function(b){var c="default",d=function(d){if("new"===c)return c="void",new e;if("void"!==c){c="new";var f=e();return c="default",a(f,b,d||{}),f}},e=function(){return d.apply(void 0,arguments)};return e}}(),B=new z({ctor:function(){this.keys=[],this.values=[]},add:function(a,b){j(this.keys,a)>-1||(this.keys.push(a),this.values.push(b))},remove:function(a){var b=j(this.keys,a);b>-1&&(this.keys.splice(b,1),this.values.splice(b,1))},get:function(a){var b=j(this.keys,a);return b>-1?this.values[b]:null},set:function(a,b){var c=j(this.keys,a);c>-1&&(this.values[c]=b)},contains:function(a){return j(this.keys,a)>-1}}),C=new z(function(){function a(b,c){if(c===b)return b.reject(new TypeError("2.3.1 A promise returned from onFulfilled cannot refer to itself.")),!0;if(c){var d,f=!1;try{i(c,"then")&&(d=c.then)}catch(g){return b.reject(g),!0}if(e(d)){try{d.call(c,function(c){f||(f=!0,a(b,c)||b.resolve(c))},function(a){f||(f=!0,b.reject(a))})}catch(g){f||b.reject(g)}return!0}}}function b(b,c,f){var g=function(g,h){var i,j=g===d?c:f;if(!e(j))return void(g===d?b.resolve(h):b.reject(h));try{i=j.call(void 0,h)}catch(k){return void b.reject(k)}a(b,i)||b.resolve(i)};return function(){var a=arguments;y(function(){g.apply(void 0,a)})}}var c="pending",d="fulfilled",f="rejected";return{ctor:function(a){function e(a,b){if(h===c){h=a,j=b;for(var d=0,e=i.length;e>d;d++)i[d](h,j);i=[]}}var g=this,h=c,i=[],j=null;this.then=function(a,d){var e=new C,f=b(e,a,d);return h===c?i.push(f):f(h,j),e},this.resolve=function(a){return e(d,a),this},this.reject=function(a){return e(f,a),this},this.promise={then:this.then},a&&y(function(){a.call(void 0,g.resolve,g.reject)})},splat:function(a,b){return this.then(function(b){return a.apply(void 0,b)},b)}}});C.when=function(c){c=f(c)?c:a(arguments);var d=new C,e=0,g=[];return b(c,function(a,b){a.then(function(a){g[b]=a,++e===c.length&&d.resolve(g)},function(a){d.reject(a)})}),c.length||d.resolve([]),d.promise};var D,E=new A({access:null,method:null,callsuper:!1}),F=new z({ctor:function(){this.controller=null,this.tunnel=null},init:function(a,b,c,d){var e=this,f=this.controller.createScope(a);return p(f.self,"_pub",{get:function(){return b}}),this._build(f),this._expose(f,b),p(b,"__scope__",{enumerable:!1,get:function(){return e.tunnel.value()===a.ctor?f.self:void 0}}),d&&f.self.ctor.apply(f.self,c),o(function(){function b(c){null!==c.template.parent&&b(c.parent);for(var d=0,e=c.template.members.values.length;e>d;d++)c.template.members.values[d]instanceof K&&c.self[a.members.keys[d]]()}b(f)}),f},_build:function(a){for(var b=0,c=a.template.mixins.length;c>b;b++){var d=this.init(a.template.mixins[b],a.self._pub,[],!1);this._proxy(d,a),a.mixins.push(d)}if(null!==a.template.parent){var e=a.template.parent.members.get(x);if(null!==e&&e.params.length>0){var f=a.template.members.get(x);if(null===f||f.callsuper===!1)throw s("InitializationError","Base constructor contains parameters and must be called explicitly.")}a.parent=this.controller.createScope(a.template.parent),a.parent.self._pub=a.self._pub,this._build(a.parent)}for(null!==a.template.parent&&this._proxy(a.parent,a),b=0,c=a.template.members.values.length;c>b;b++)a.template.members.values[b].build(a);if(!a.self.ctor){var g=new K;g.name=x,g.access=v,g.method=function(){},g.build(a)}},_proxy:function(a,b){for(var c=0,d=a.template.members.values.length;d>c;c++){var e=a.template.members.values[c];if(e.access!==v&&!b.template.members.get(e.name))if(e instanceof K||e instanceof I)b.self[e.name]=a.self[e.name];else if(e instanceof L){var f={};e.get&&e.get.access!==v&&(f.get=function(){return a.self[e.name]}),e.set&&e.set.access!==v&&(f.set=function(b){a.self[e.name]=b}),p(b.self,e.name,f)}}},_expose:function(a,c){null!==a.template.parent&&this._expose(a.parent,c),b(a.template.members.values,function(b){if(b.access===u)if(b instanceof K)c[b.name]=a.self[b.name];else if(b instanceof I)p(c,b.name,{get:function(){return a.self[b.name]._pub},set:function(c){a.self[b.name]=c}});else if(b instanceof L){var d={};b.get&&b.get.access===u&&(d.get=function(){return a.self[b.name]}),b.set&&b.set.access===u&&(d.set=function(c){a.self[b.name]=c}),p(c,b.name,d)}})}}),G=new z(function(){function a(b,c){var d=b.prototype;d.constructor.prototype!==d&&a(d.constructor,c);for(var e in d)i(d,e)&&(c[e]=d[e])}function b(){var a,b=document.createElement();for(a in b)i(b,a)&&c(b,a);return b}function c(a,b){var c;Object.defineProperty(a,b,{configurable:!0,get:function(){return c},set:function(a){c=a}})}var d=function(a){return function(){return a.apply(void 0,arguments)}};return{ctor:function(){this.tunnel=null,this.builder=null,this._checkTypeOurs=!1,this._typeCheckResult=!1,this._returnScope=!1,this._returnBase=!1,this._returnTemplate=!1},isTypeOurs:function(a){this._checkTypeOurs=!0,a();var b=this._typeCheckResult;return this._typeCheckResult=!1,this._checkTypeOurs=!1,b},createScope:function(a){this._returnScope=!0;var b=a.ctor();return this._returnScope=!1,b},createEmpty:function(a){this._returnBase=!0;var b=new a.ctor;return this._returnBase=!1,b},getTemplate:function(a){this._returnTemplate=!0;var b=a();return this._returnTemplate=!1,b},createTemplate:function(){var c=this,e=null,f=new N,g=!0,h=function(){if(!c._returnBase){if(c._checkTypeOurs)return void(c._typeCheckResult=!0);if(c._returnScope){null===e&&(e=c._createSelf(f));var d=new M;return d.template=f,t?(d.self=b(),a(e,d.self)):d.self=new e,d}if(c._returnTemplate)return f;if(g){var h;return g=!1,t?(h=b(),a(f.ctor,h)):h=new f.ctor,c.builder.init(f,h,arguments,!0),g=!0,h}}};return f.ctor=d(h),f.members=new B,f},_createSelf:function(a){var b=this,c=function(){};return c.prototype=this.createEmpty(a),c.prototype._pry=function(c){b.tunnel.open(a.ctor);var d=c&&c.__scope__?c.__scope__:null;return b.tunnel.close(),d||c},c}}}),H=new z(function(){function a(a){var b=a.substr(0,2),c=m[b]||m[a[0]]||u,d=n[b]||n[a[0]]||!1;return a=a.substr(p[b]||p[a[0]]||0),a===x&&(c=v,d=!1),new J({access:c,virtual:d,name:a})}function b(a,b){if(c(a,b.name))throw s("DefinitionError","Member '"+b.name+"' is already defined.");if(b.access!==v&&null!==a.parent){var d=a.parent.members.get(b.name);if(null!==d&&d.access!==b.access)throw s("DefinitionError","Cannot change access modifier of member '"+b.name+"' from "+d.access+" to "+b.access+".")}}function c(a,b,d){var e=a.members.get(b);return null===e||d&&e.access===v||d&&!(e instanceof I)&&e.virtual!==!1?null!==a.parent?c(a.parent,b,!0):!1:!0}function i(a){var b=[],c=a.toString().match(/^function\s*\(([^())]+)\)/);if(null!==c)for(var d=c[1].split(","),e=0,f=d.length;f>e;e++)b.push(g(d[e]));var h=new K;return h.method=a,h.params=b,h.callsuper=r.test(a),h}function j(b,c,f){var g=new L;g.access=c.access,g.name=c.name,g.virtual=c.virtual,"object"!==d(f)?(g.value=f,f={}):g.value=f.value,void 0===g.value&&(g.value=null);for(var i=h(f),j=0,l=i.length;l>j;j++){var m=f[i[j]],n=a(i[j].toLowerCase());if("get"===n.name||"set"===n.name){if(n.virtual)throw s("DefinitionError","Property '"+c.name+"' cannot have virtual accessors.");if(null!==m&&!e(m))throw s("TypeError","The "+n.name+" accessor for property '"+c.name+"' must be a function or null (uses default implementation.)");g[n.name]=new E({access:n.access===u?c.access:n.access,method:m})}}return g.get||g.set||(g.get=new E({access:c.access}),g.set=new E({access:c.access})),null!==g.get&&(null===g.get.method&&(g.get.method=function(){return this._value()}),g.get.callsuper=r.test(g.get.method)),null!==g.set&&(null===g.set.method&&(g.set.method=function(a){this._value(a)}),g.set.callsuper=r.test(g.set.method)),k(b,g),g}function k(a,b){for(var c=["get","set"],d=0,e=0,f=c.length;f>e;e++){var g=c[e],h=b[g];if(null!==h){var i=null!==a.parent?a.parent.members.get(b.name):null;if(null!==i&&i.access!==v&&null===i[g])throw s("DefinitionError","Cannot change read/write definition of property '"+b.name+"'.");if(q[h.access]<q[b.access])throw s("DefinitionError","The "+g+" accessor of the property '"+b.name+"' cannot have a higher visibility than the property itself.");if(h.access!==b.access&&d++,null!==i&&h.access!==i.access)throw s("DefinitionError","Cannot change access modifier of '"+g+"' accessor for property '"+b.name+"' from "+i.access+" to "+h.access+".")}}if(2===d)throw s("DefinitionError","Cannot set access modifers for both accessors of the property '"+b.name+"'.")}function l(a,b){if(a===b)throw s("DefinitionError","Cannot include type that includes self.");for(var c=0,d=b.mixins.length;d>c;c++)l(a,b.mixins[c])}var m={__:v,_:w},n={$:!0,_$:!0},p={__:2,_$:2,_:1,$:1},q={};q[u]=1,q[w]=2,q[v]=3;var r=/xyz/.test(function(){xyz=0})?/\b_super\b/:/.*/;return{ctor:function(){this.controller=null},defineParent:function(a,b){if(a.members.keys.length>0)throw s("DefinitionError","Cannot change the parent type after members have been defined.");if(!e(b))throw s("TypeError","Parent type must be a function.");if(this.controller.isTypeOurs(b)){for(var c=this.controller.getTemplate(b),d=c;d;){if(d===a)throw s("DefinitionError","Cannot inherit from "+(c===a?"self":"derived type")+".");d=d.parent}a.parent=c,a.ctor.prototype=this.controller.createEmpty(c)}else a.ctor.prototype=new b},defineMembers:function(d,g){for(var k=h(g||{}),l=0,m=k.length;m>l;l++){var n=a(k[l]),p=g[k[l]];if(b(d,n),o(function(){return c(d,n.name)}))return;if(n.name===x&&(f(p)&&(d.ctor.$inject=p,p=p.pop()),!e(p)))throw s("TypeError","Member '"+x+"' must be a function.");var q=e(p)?i(p):j(d,n,p);if(n.name===x&&!q.callsuper&&null!==d.parent){var r=d.parent.members.get(x);if(null!==r&&r.params.length>0)throw s("DefinitionError","Constructor must call the parent constructor explicitly because it contains parameters.")}q.name=n.name,q.access=n.access,q.virtual=n.virtual,d.members.add(n.name,q)}},defineEvents:function(c,d){for(var e=0,f=d.length;f>e;e++){var g=a(d[e]);if(b(c,g),g.name===x)throw s("DefinitionError","Event cannot be named 'ctor'.");if(g.virtual)throw s("DefinitionError","Events cannot be virtual.");var h=new I;h.name=g.name,h.access=g.access,c.members.add(g.name,h)}},defineMixins:function(a,b){if(a.members.contains(x))throw s("DefinitionError","Mixins must be defined before the constructor.");for(var c=0,d=b.length;d>c;c++){if(!this.controller.isTypeOurs(b[c]))throw s("TypeError","Mixin must be a type.");var e=this.controller.getTemplate(b[c]);if(e===a)throw s("DefinitionError","Cannot include self.");l(a,e),a.mixins.push(e)}}}}),I=new z(function(){var a=function(){var a,b=function(a,b){return a=n(a,b),a.valueOf=c,a};b.operands=[],b.reset=function(){b.operands=[],Function.prototype.valueOf=a};var c=function(){return 2===b.operands.length&&b.operands.splice(0,1),b.operands.push(this),Function.prototype.valueOf!==c&&(a=Function.prototype.valueOf,Function.prototype.valueOf=c),3};return b}();return{ctor:function(){this.name=null,this.access=null},build:function(b){function c(a){f.push(a)}function d(a){var b=j(f,a);b>-1&&f.splice(b,1)}var e=this,f=[],g=new a(function(){for(var a=0,b=f.length;b>a;a++)f[a].apply(void 0,arguments)});g._pub=new a(function(){throw s("InvalidOperationError","The event '"+e.name+"' cannot be raised except from within its own type.")}),p(b.self,this.name,{get:function(){return g},set:function(b){if(2===a.operands.length&&(a.operands[0]===g||a.operands[0]===g._pub)){var e=a.operands[1];6===b?c(e):0===b&&d(e)}a.reset()}})}}}),J=new A({access:null,virtual:!1,name:null}),K=new z({ctor:function(){this.callsuper=!1,this.params=[],this.access=null,this.virtual=!1,this.name=null,this.method=null},build:function(a){var b=this;if(this.name===x)this._buildConstructor(a);else if(null!==a.parent&&a.parent.self[this.name]){var c=a.parent.self[this.name];a.self[this.name]=function(){var d=a.self._super;a.self._super=c;var e=b.method.apply(a.self,arguments);return void 0===d?delete a.self._super:a.self._super=d,e}}else a.self[this.name]=function(){return b.method.apply(a.self,arguments)};a.self[this.name]=a.self[this.name]},_buildConstructor:function(b){var c=this;b.self.ctor=function(){delete b.self.ctor;for(var d=new B,e={_init:b.self._init,_super:b.self._super},f=0,g=b.template.mixins.length;g>f;f++){var h=b.template.mixins[f];h.members.contains(x)&&(h.members.get(x).params.length>0?d.add(h.ctor,h):h.members.get(x).method.call(b.mixins[f].self))}if(d.keys.length>0&&(b.self._init=function(c){if(!d.contains(c))throw s("InitializationError","Mixin is not defined for this type or has already been initialized.");var e=a(arguments);e.shift();var f=d.get(c),g=b.mixins[j(b.template.mixins,f)];f.members.get(x).method.apply(g,e),d.remove(c)}),null!==b.template.parent&&b.template.parent.members.contains(x)&&(b.template.parent.members.get(x).params.length>0?b.self._super=b.parent.self.ctor:b.parent.self.ctor()),c.method.apply(b.self,arguments),void 0===e._super?delete b.self._super:b.self._super=e._super,void 0===e._init?delete b.self._init:b.self._init=e._init,d.keys.length>0)throw s("InitializationError","Some mixins were not initialized. Please make sure the constructor calls this._init() for each mixin having parameters in its constructor.")}}}),L=new z({ctor:function(){this.name=null,this.access=null,this.value=null,this.virtual=!1,this.get=null,this.set=null},build:function(a){function b(b,c){return function(){var e={_super:a.self._super,_value:a.self._value};a.self._super=c,a.self._value=function(a){return arguments.length&&(d=a),d};var f=b.apply(a.self,arguments);return void 0===e._super?delete a.self._super:a.self._super=e._super,void 0===e._value?delete a.self._value:a.self._value=e._value,f}}var c=this,d=this.value,e={};this.get&&(e.get=b(this.get.method,null===a.parent?null:function(){return a.parent.self[c.name]})),this.set&&(e.set=b(this.set.method,null===a.parent?null:function(b){a.parent.self[c.name]=b})),p(a.self,this.name,e)}}),M=new A({parent:null,self:null,mixins:[],template:null}),N=new A({members:null,parent:null,mixins:[],ctor:null}),O=new z({ctor:function(){this._value=null},open:function(a){this._value=a},close:function(){this._value=null},value:function(){return this._value}}),P=void 0,Q=new z({ctor:function(){this._pending={},this._cache={},this._browser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),this._last=null,D=n(this._onTypeDefined,this)},fetch:function(a){var b=new C;if(this._browser){var c=a.url;if(c=/^\/\//.test(c)?window.location.protocol+c:/^\//.test(c)?window.location.protocol+"//"+window.location.host+c:window.location.protocol+"//"+window.location.host+window.location.pathname+c,this._cache[c])b.resolve(this._cache[c]);else if(this._pending[c])this._pending[c].bind(b);else{var d=document.createElement("script");d.src=c,d.addEventListener("error",function(){b.reject()},!1),document.body.appendChild(d),this._pending[c]=b}}else this._last=b,require(a.url);return b.promise},_onTypeDefined:function(a){if(this._browser){var b=document.getElementsByTagName("script"),c=b[b.length-1].src;if(this._pending[c]){this._cache[c]=a;var d=this._pending[c];delete this._pending[c],setTimeout(function(){d.resolve(a)})}}else if(null!==this._last){var d=this._last;this._last=null,d.resolve(a)}}}),R=function(){function b(){var b=d.createTemplate(),c=a(arguments);if(e(c[0])){var f=function(c,d){return function(){return c.apply(g,[b].concat(a(arguments))),d}},h={extend:f(g.defineParent,h),include:f(g.defineMixins,h),events:f(g.defineEvents,h),members:f(g.defineMembers,h)};c[0].call(h)}else 2===c.length&&(c[0].extend&&g.defineParent(b,c[0].extend),c[0].include&&g.defineMixins(b,c[0].include),c[0].events&&g.defineEvents(b,c[0].events)),c.length>0&&g.defineMembers(b,c[1]||c[0]);return D&&D(b.ctor),o(b.ctor),b.ctor}var c=new F,d=new G,f=new O,g=new H;return c.controller=d,c.tunnel=f,d.builder=c,d.tunnel=f,g.controller=d,function(){return b.apply(void 0,arguments)}}(),S=new A({create:function(){},inject:[],filter:[]}),T=new R({ctor:function(a){this.binding=a},asSingleton:function(){var a,b=this.binding.create,c=!1;return this.binding.create=function(){return c||(a=b.apply(void 0,arguments),c=!0),a},this._pub},whenFor:function(a){if(!f(a)||!a.length)throw s("ArgumentError","Expected 'services' to be an array of string.");return this.binding.filter=a.slice(0),this._pub}}),U=new z({ctor:function(a,b){this._cookbook=a,this._handlers=[],this.missing=[],this.component=null;var c=b instanceof Z?b:this._cookbook.search(b);if(null!==c)this.component=this._prepare(c);else{this.missing.push(b);var d=this;this._onUpdate(b,function(a){d.component=a})}},update:function(a){this.missing.splice(0);for(var b=this._handlers.slice(0),c=0,d=b.length;d>c;c++)b[c](a)},_prepare:function(a){for(var b=new W(a),c=[b];c.length;){var d=c.shift();if(!d.recipe.lazy)for(var e=0,f=d.recipe.ingredients.length;f>e;e++){var g=d.recipe.ingredients[e],a=this._cookbook.search(g,d.recipe.name);if(a){var h=new W(a);h.parent=d,h.order=e,d.children[e]=h,c.push(h)}else this.missing.push(g),this._onUpdate(g,function(a,b){return function(c){c.parent=a,c.order=b,a.children[e]=c}}(d,e))}}return b},_onUpdate:function(a,b){var c=this,d=a instanceof r,e=d||a instanceof q;(d||e)&&(a=a.value);var f=function(g){var h=g[a];if(h){var i=c._cookbook.search(h);i?(i.factory=e,i.lazy=d,b(c._prepare(i))):(c.missing.push(h),c._onUpdate(h,b)),c._handlers.splice(j(c._handlers,f),1)}};this._handlers.push(f)}}),V=new z({ctor:function(a,b){this._cookbook=a,this._loader=b},create:function(a){function b(){h=i._getRelativePaths(k.missing),i._loader()(h).then(c,g,!1)}function c(a){for(var c={},g=0,i=k.missing.length;i>g;g++){var l=k.missing[g].value||k.missing[g],m=a[g];if(!m||!/(string|function|array)/.test(d(m)))return j.reject(new TypeError("Module '"+h[g]+"' loaded successfully. Failed to resolve service '"+l+"'. Expected service to be a string, array, or function. Found '"+(m&&m.toString?m.toString():d(m))+"' instead.")),!1;if(f(m)&&!e(m[m.length-1]))return m=m[m.length-1],j.reject(new TypeError("Module '"+h[g]+"' loaded successfully. Failed to resolve service '"+l+"'. Found array. Expected last element to be a function. Found '"+(m&&m.toString?m.toString():d(m))+"' instead.")),!1;c[l]=a[g]}"rejected"!==j.state&&(k.update(c),k.missing.length?b():j.resolve(k.component))}function g(a){j.reject(a)}var h,i=this,j=new C,k=new U(this._cookbook,a);return k.missing.length?this._loader()?b():j.reject(new s("InvalidOperationError","Service(s) "+l(k.missing,function(a){return"'"+a+"'"}).join(", ")+" have not been registered.")):j.resolve(k.component),j.promise},createFactory:function(b){if(b.recipe.lazy)return this._createLazy(b);for(var c=this,d=[],e=b,f=[e];f.length;){var g=f.shift();if(d.push(g),!g.recipe.lazy)for(var h=0,i=g.children.length;i>h;h++)f.push(g.children[h])}return d.reverse(),d.pop(),function(){for(var b=0,f=d.length;f>b;b++){var g=d[b];g.parent.prep[g.order]=g.recipe.factory?c.createFactory(g):g.recipe.create.apply(void 0,g.prep),g.prep=[]}var h=e.prep.concat(a(arguments));return e.prep=[],e.recipe.create.apply(void 0,h)}},_createLazy:function(a){var b=this,c=null;return function(){var d=arguments;return c?(new C).resolve(c.apply(void 0,d)).promise:b.create(a.recipe.name).then(function(a){return c=b.createFactory(a),c.apply(void 0,d)},function(a){throw a},!1)}},_getRelativePaths:function(a){return l(a,function(a){return a instanceof q?a=a.value:a instanceof r&&(a=a.value),a.replace(/\./g,"/")})}}),W=new z({ctor:function(a){this.parent=null,this.order=null,this.prep=[],this.recipe=a,this.children=[]}}),X=new z({ctor:function(a){this._container=a},search:function(a,b){var c;return e(a)?new Z({create:a,ingredients:(a.$inject||[]).slice(0)}):f(a)?(a=a.slice(0),new Z({create:a.pop(),ingredients:a})):"string"===d(a)&&(c=this._lookup(a,b))?new Z({create:c.create,ingredients:c.inject.slice(0),name:a}):a instanceof q&&(c=this._lookup(a.value,b))?new Z({create:c.create,ingredients:c.inject.slice(0),name:a.value,factory:!0}):a instanceof r?(c=this._lookup(a.value,b)||{},new Z({create:c.create||null,ingredients:c.inject?c.inject.slice(0):null,name:a.value,factory:!0,lazy:!0})):null},_lookup:function(a,b){for(var c=this._container[a]||[],d=c.length-1;d>=0;d--)if(b){if(!c[d].filter.length||j(c[d].filter,b)>-1)break}else if(!c[d].filter.length)break;return c[d]||null}}),Y=new R(function(){var b=new R({ctor:function(a,b){this.kernel=a,this.service=b},to:function(a){return new T(this.kernel.register(this.service,a))},toConstant:function(a){return new T(this.kernel.register(this.service,function(){return a}))}}),g=new Q;this.members({ctor:function(){this.container={},this.require=null;var a=this,b=new X(this.container);this.chef=new V(b,function(){return a.require})},bind:function(a){if(!a||"string"!==d(a))throw s("ArgumentError","Argument 'service' must have a value.");return new b(this,a)},unbind:function(a,b){b=b||[];var c=this.container[a]||[],d=b.length;if(d){for(var e,f,g=0,h=c.length;h>g;g++){if(c[g].filter)for(e=0;d>e;e++)for(f=j(c[g].filter,b[e]);f>-1;)c[g].filter.splice(f,1),f=j(c[g].filter,b[e]);c[g].filter.length||(c.splice(g,1),g--)}c.length||delete this.container[a]}else delete this.container[a];return this._pub},resolve:function(b,c){var d=this;return c=a(arguments),c.shift(0),this.chef.create(b).then(function(a){var b=d.chef.createFactory(a);return a.recipe.factory?b:b.apply(void 0,c)},function(a){throw a})},autoBind:function(a){return this.registerGraph("",a),this._pub},autoLoad:function(a){if(a===!1)this.require=null;else{var b;e(a)?b=a:("string"===d(a)&&(a={baseUrl:a}),a={baseUrl:a.baseUrl||"",waitSeconds:0===a.waitSeconds||a.waitSeconds?a.waitSeconds:7,urlArgs:a.urlArgs||"",scriptType:a.scriptType||"text/javascript"},b=function(b){var c=m(a.baseUrl,b);return/\.js$/.test(c)||(c+=".js"),g.fetch({url:c,timeout:1e3*a.waitSeconds,query:a.urlArgs,scriptType:a.scriptType})}),this.require=function(a){return C.when(l(a,function(a){var c=b(a);if(!c||!e(c.then))throw s("TypeError","Service loader must return a promise.");return c}))}}},__register:function(a,b){var c=null;if(f(b)){if(b=b.slice(0),c=new S({create:b.pop(),inject:b}),!e(c.create))throw s("ArgumentError","Expected last array element to be a function.")}else if(c=new S({create:b,inject:(b.$inject||[]).slice(0)}),!e(c.create))throw s("ArgumentError","Expected provider to be a function.");return this.container[a]=this.container[a]||[],this.container[a].push(c),c},__registerGraph:function(a,b){var d=this,e=""===a?"":a+".";c(b,function(a,b){k(a)?d.registerGraph(e+b,a):d.register(e+b,a)})}})}),Z=new A({create:function(){},ingredients:[],name:null,factory:!1,lazy:!1}),$={Class:R,Error:s,of:d,Task:C,Kernel:Y,Factory:q,Lazy:r,proxy:n,Module:P};"undefined"!=typeof module&&module.exports?module.exports=$:window.type=$}();