/*! type v1.0.5 */
!function(e){"use strict";function t(e){var t=e.length,n=o(e);return"window"===o(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function n(e){if(a(e))return e;var n=[];if(t(e))for(var r=0,o=e.length;o>r;r++)n.push(e[r]);else i(e,function(e){n.push(e)});return n}function r(e,t){if(Array.prototype.forEach)e.forEach(t);else for(var n=0,r=e.length;r>n&&t.call(void 0,e[n],n)!==!1;n++);}function i(e,t){for(var n in e)if(p(e,n)&&t.call(void 0,e[n],n)===!1)break}function o(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}function s(e){return"function"===o(e)}function a(e){return"array"===o(e)}function u(e){return"object"===o(e)}function c(e){return"string"===o(e)}function l(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function f(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)p(e,n)&&t.push(n);return t}function p(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e,t){if(e.indexOf)return e.indexOf(t);var n=-1;return r(e,function(e,r){return e===t?(n=r,!1):void 0}),n}function v(e){if("object"!==o(e)||e.nodeType||"window"===o(e))return!1;try{if(e.constructor&&!p(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0}function m(e,t,i){if(e=n(e),Array.prototype.map)return e.map(t,i);var o=[];return r(e,function(e,n){o.push(t.call(i,e,n))}),o}function d(){return m(arguments,function(e,t){return 0===t?e.replace(/\/$/,""):e.replace(/(^\/|\/$)/g,"")}).join("/")}function g(e,t){return function(){return e.apply(t,arguments)}}function y(e,t){return t?e():void 0}function w(e,t,n){void 0===n.enumerable&&(n.enumerable=!0),void 0===n.configurable&&(n.configurable=!0),Object.defineProperty(e,t,n)}function _(e){for(;;)if(!e.call(void 0))break}function b(e,t){for(var n=e.split("."),r=0,i=n.length,o=t||window;i>r;r++)p(o,n[r])||(o[n[r]]={}),o=o[n[r]];return o}function k(e,t,n){function r(n,r){var i=Object.getOwnPropertyDescriptor(t,n),o=!1,a=!1;if((void 0===i||"value"in i)&&(s(t[n])&&(e[r]=g(t[n],t),a=!0),o=!0),!a){var u,c;(o||void 0!==i.get)&&(u=function(){return t[n]}),(o||void 0!==i.set)&&(c=function(e){t[n]=e}),w(e,r,{get:u,set:c})}}var i,o,u=0;if(n)if(a(n))for(o=n.length;o>u;u++)r(n[u],n[u]);else{var c=f(n);for(o=c.length;o>u;u++)r(c[u],n[c[u]])}else for(i in t)r(i,i);return e}function E(e){return this instanceof E?void(this.value=e):new E(e)}function $(e){return this instanceof $?void(this.value=e):new $(e)}var j=function(){function e(e,n){if(!t[e]){var r=function(e){this.message=e};r.prototype=new t.Error,r.prototype.name=e,t[e]=r}return n?new t[e](n):t[e]}var t={Error:Error,TypeError:TypeError};return function(){return e.apply(void 0,arguments)}}(),x=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),T="public",O="private",P="protected",C="ctor",A=function(){if(e.setImmediate)return e.setImmediate;var t=[],n="https://github.com/stephenbunch/type/zero-timeout-message",r=function(e){t.push(e),window.postMessage(n,"*")},i=function(e){e.source===window&&e.data===n&&t.length>0&&t.shift()()};return window.addEventListener?window.addEventListener("message",i):window.attachEvent("onmessage",i),r}(),D=function(e){e=e||{},s(e)&&(e=e());var t="default",n=function(){if("new"===t)return t="void",new r;if("void"!==t){t="new";var e=r();t="default";var n=e.ctor.apply(e,arguments);return s(n)||a(n)||u(n)?n:e}},r=function(){return n.apply(void 0,arguments)};return e.ctor||(e.ctor=function(){}),r.prototype=e,r},L=function(){function e(e,t,n){for(var r=[{src:n,tmpl:t,dest:e}];r.length;){var i=r.shift();if(i.array)for(var s=0,a=i.array.length;a>s;s++)switch(o(i.array[s])){case"object":var u=i.array[s];i.array[s]={},r.push({tmpl:u,dest:i.array[s]});break;case"array":i.array[s]=i.array[s].slice(0),r.push({array:i.array[s]})}else for(var c in i.tmpl)if(void 0!==i.src[c])i.dest[c]=i.src[c];else switch(o(i.tmpl[c])){case"object":i.dest[c]={},r.push({tmpl:i.tmpl[c],dest:i.dest[c]});break;case"array":i.dest[c]=i.tmpl[c].slice(0),r.push({array:i.dest[c]});break;default:i.dest[c]=i.tmpl[c]}}}return function(t){var n="default",r=function(r){if("new"===n)return n="void",new i;if("void"!==n){n="new";var o=i();return n="default",e(o,t,r||{}),o}},i=function(){return r.apply(void 0,arguments)};return i}}(),F=new D({ctor:function(){this.keys=[],this.values=[]},add:function(e,t){h(this.keys,e)>-1||(this.keys.push(e),this.values.push(t))},remove:function(e){var t=h(this.keys,e);t>-1&&(this.keys.splice(t,1),this.values.splice(t,1))},get:function(e){var t=h(this.keys,e);return t>-1?this.values[t]:null},set:function(e,t){var n=h(this.keys,e);n>-1&&(this.values[n]=t)},contains:function(e){return h(this.keys,e)>-1}}),S=new D(function(){function e(t,n){if(n===t||n===t.promise)return t.reject(new TypeError("2.3.1 A promise returned from onFulfilled cannot refer to itself.")),!0;if(n){var r,i=!1;try{r=n.then,("object"!=typeof n||"function"!=typeof r)&&(r=void 0)}catch(o){return t.reject(o),!0}if(s(r)){try{r.call(n,function(n){i||(i=!0,e(t,n)||t.resolve(n))},function(e){i||(i=!0,t.reject(e))})}catch(o){i||t.reject(o)}return!0}}}function t(t,n,i){var o=function(o,a){var u,c=o===r?n:i;if(!s(c))return void(o===r?t.resolve(a):t.reject(a));try{u=c.call(void 0,a)}catch(l){return void t.reject(l)}e(t,u)||t.resolve(u)};return function(){var e=arguments;A(function(){o.apply(void 0,e)})}}var n="pending",r="fulfilled",i="rejected";return{ctor:function(e){function o(e,t){if(a===n){a=e,c=t;for(var r=0,i=u.length;i>r;r++)u[r](a,c);u=[]}}var s=this,a=n,u=[],c=null;this.then=function(e,r){var i=new S,o=t(i,e,r);return a===n?u.push(o):o(a,c),i.promise},this.resolve=function(e){return o(r,e),s},this.reject=function(e){return o(i,e),s},this.finally=function(e){return s.then(function(t){var n=e.apply(void 0,arguments);return n&&"function"==typeof n.then?n.then(function(){return t}):t},function(t){var n=e(t);if(n&&"function"==typeof n.then)return n.then(function(){throw t});throw t})},this.promise={then:this.then,"finally":this.finally},w(this,"value",{get:function(){return c}}),w(this.promise,"value",{get:function(){return c}}),e&&e.call(void 0,s.resolve,s.reject)},splat:function(e,t){return this.then(function(t){return e.apply(void 0,t)},t)}}});S.when=function(e){e=a(e)?e:n(arguments);var t=new S,i=0,o=[];return r(e,function(n,r){n.then(function(n){o[r]=n,++i===e.length&&t.resolve(o)},function(e){t.reject(e)})}),e.length||t.resolve([]),t.promise},S.chain=function(e){e=a(e)?e:n(arguments);var t=new S;t.resolve();var i=t.promise;return r(e,function(e){i=i.then(s(e)?e:function(){return e})}),i},S.from=function(e){return(new S).resolve(e).promise};var z=new L({access:null,method:null,callsuper:!1}),q=new D({ctor:function(){this.system=null,this.tunnel=null},init:function(e,t,n,r){var i=this,o=this.system.createScope(e);return o.pub=t,this._build(o),this._morph(o),this._expose(o),w(o.pub,"__scope__",{enumerable:!1,get:function(){var e=o,t=i.tunnel.value();if(null!==t)for(;null!==e;){if(t===e.template.ctor)return e;e=e.parent}}}),r&&o.self.ctor.apply(o.self,n),y(function(){function t(n){null!==n.template.parent&&t(n.parent);for(var r=0,i=n.template.members.values.length;i>r;r++)n.template.members.values[r]instanceof B&&n.self[e.members.keys[r]]()}t(o)}),e=null,t=null,n=null,r=null,o},_build:function(e){null!==e.template.parent&&(e.parent=this.system.createScope(e.template.parent),e.parent.derived=e,e.parent.pub=e.pub,this._build(e.parent)),w(e.self,"$pub",{get:function(){return e.pub}}),null!==e.template.parent&&this._proxy(e.parent,e);for(var t=0,n=e.template.members.values.length;n>t;t++)e.template.members.values[t].build(e);if(!e.self.ctor){var r=new B;r.name=C,r.access=O,r.method=function(){},r.build(e)}},_proxy:function(e,t){for(var n=0,r=e.template.members.values.length;r>n;n++){var i=e.template.members.values[n];i.access===O||t.template.members.get(i.name)||(i instanceof B?t.self[i.name]=e.self[i.name]:i instanceof M?this._proxyEvent(e,t.self,i):i instanceof G&&this._proxyProperty(e,t.self,i,[T,P]))}},_proxyEvent:function(e,t,n){w(t,n.name,{get:function(){return e.self[n.name].$pub},set:function(t){e.self[n.name]=t}})},_proxyProperty:function(e,t,n,r){var i={};n.get&&r.indexOf(n.get.access)>-1&&(i.get=function(){return e.self[n.name]}),n.set&&r.indexOf(n.set.access)>-1&&(i.set=function(t){e.self[n.name]=t}),w(t,n.name,i)},_morph:function(e){for(var t=e;null!==t.template.parent;){for(var n=0,r=t.template.parent.members.values.length;r>n;n++){var i=t.template.parent.members.values[n];if(i.virtual){var o=t.template.members.get(i.name);null!==o&&o.virtual&&t!==e||this._reverseProxy(i,null===o?t.parent:t,t.parent)}}t=t.parent}},_reverseProxy:function(e,t,n){var r;for(e instanceof G&&(r={},e.get&&e.get.access!==O&&(r.get=function(){return t.self[e.name]}),e.set&&e.set.access!==O&&(r.set=function(n){t.self[e.name]=n}));null!==n;)e instanceof B?n.self[e.name]=t.self[e.name]:e instanceof G&&w(n.self,e.name,r),n=n.parent},_expose:function(e){null!==e.template.parent&&this._expose(e.parent);for(var t=0,n=e.template.members.values.length;n>t;t++){var r=e.template.members.values[t];r.access===T&&(r instanceof B?e.pub[r.name]=e.self[r.name]:r instanceof M?this._proxyEvent(e,e.pub,r):r instanceof G&&this._proxyProperty(e,e.pub,r,[T]))}}}),I=new D(function(){function e(e){var t=e.substr(0,2),n=p[t]||p[e[0]]||T,r=h[t]||h[e[0]]||!1;return e=e.substr(v[t]||v[e[0]]||0),e===C&&(n=O,r=!1),new R({access:n,virtual:r,name:e})}function t(e,t){if(n(e,t.name))throw j("DefinitionError","Member '"+t.name+"' is already defined.");if(t.access!==O&&null!==e.parent){var r=e.parent.members.get(t.name);if(null!==r&&r.access!==t.access)throw j("DefinitionError","Cannot change access modifier of member '"+t.name+"' from "+r.access+" to "+t.access+".")}}function n(e,t,r){var i=e.members.get(t);return null===i||r&&i.access===O||r&&!(i instanceof M)&&i.virtual!==!1?null!==e.parent?n(e.parent,t,!0):!1:!0}function i(e){var t=[],n=e.toString().match(/^function\s*\(([^())]+)\)/);if(null!==n)for(var r=n[1].split(","),i=0,o=r.length;o>i;i++)t.push(l(r[i]));var s=new B;return s.method=e,s.params=t,s}function o(t,n,r){var i=new G;i.access=n.access,i.name=n.name,i.virtual=n.virtual,u(r)?i.value=r.value:(i.value=r,r={}),void 0===i.value&&(i.value=null);for(var o=f(r),a=0,l=o.length;l>a;a++){var p=r[o[a]],h=e(o[a].toLowerCase());if("get"===h.name||"set"===h.name){if(h.virtual)throw j("DefinitionError","Property '"+n.name+"' cannot have virtual accessors.");if(null!==p&&!s(p))throw j("TypeError","The "+h.name+" accessor for property '"+n.name+"' must be a function or null (uses default implementation.)");i[h.name]=new z({access:h.access===T?n.access:h.access,method:p})}}return i.get||i.set||(i.get=new z({access:n.access}),i.set=new z({access:n.access})),null!==i.get&&null===i.get.method&&(i.get.method=function(){return this.$value()}),null!==i.set&&null===i.set.method&&(i.set.method=function(e){this.$value(e)}),c(t,i),i}function c(e,t){for(var n=["get","set"],r=0,i=0,o=n.length;o>i;i++){var s=n[i],a=t[s];if(null!==a){var u=null!==e.parent?e.parent.members.get(t.name):null;if(null!==u&&u.access!==O&&null===u[s])throw j("DefinitionError","Cannot change read/write definition of property '"+t.name+"'.");if(m[a.access]<m[t.access])throw j("DefinitionError","The "+s+" accessor of the property '"+t.name+"' cannot have a higher visibility than the property itself.");if(a.access!==t.access&&r++,null!==u&&a.access!==u.access)throw j("DefinitionError","Cannot change access modifier of '"+s+"' accessor for property '"+t.name+"' from "+u.access+" to "+a.access+".")}}if(2===r)throw j("DefinitionError","Cannot set access modifers for both accessors of the property '"+t.name+"'.")}var p={__:O,_:P},h={$:!0,_$:!0},v={__:2,_$:2,_:1,$:1},m={};return m[T]=1,m[P]=2,m[O]=3,{ctor:function(){this.system=null},theParent:function(e,t){if(e.members.keys.length>0)throw j("DefinitionError","Cannot change the parent type after members have been defined.");if(!s(t))throw j("TypeError","Parent type must be a function.");if(this.system.isTypeOurs(t)){for(var n=this.system.getTemplate(t),r=n;r;){if(r===e)throw j("DefinitionError","Cannot inherit from "+(n===e?"self":"derived type")+".");r=r.parent}e.parent=n,e.ctor.prototype=this.system.createEmpty(n)}else e.ctor.prototype=new t},theMembers:function(c,l){l=u(l)?l:{},r(f(l),function(r){var u=e(r),f=l[r];if(t(c,u),!y(function(){return n(c,u.name)})){if(u.name===C&&(a(f)&&(c.ctor.$inject=f,f=f.pop()),!s(f)))throw j("TypeError","Member '"+C+"' must be a function.");var p;if(f===I.Event){if(p=new M,u.virtual)throw j("DefinitionError","Events cannot be virtual.")}else p=s(f)?i(f):o(c,u,f),p.virtual=u.virtual;p.name=u.name,p.access=u.access,p.virtual=u.virtual,c.members.add(u.name,p)}})}}});I.Event=function(){var e=function(){};return new e}();var M=new D(function(){var e=function(){var e,t=function(e,t){return e=g(e,t),e.valueOf=n,e};t.operands=[],t.reset=function(){t.operands=[],Function.prototype.valueOf=e};var n=function(){return 2===t.operands.length&&t.operands.splice(0,1),t.operands.push(this),Function.prototype.valueOf!==n&&(e=Function.prototype.valueOf,Function.prototype.valueOf=n),3};return t}();return{ctor:function(){this.name=null,this.access=null},build:function(t){function n(e){o.push(e)}function r(e){var t=h(o,e);t>-1&&o.splice(t,1)}var i=this,o=[],s=new e(function(){for(var e=o.slice(),t=0,n=e.length;n>t;t++)e[t].apply(void 0,arguments)});s.$pub=new e(function(){throw j("InvalidOperationError","The event '"+i.name+"' cannot be raised except from within its own type.")}),w(t.self,this.name,{get:function(){return s},set:function(t){if(2===e.operands.length&&(e.operands[0]===s||e.operands[0]===s.$pub)){var i=e.operands[1];6===t?n(i):0===t&&r(i)}e.reset()}})}}}),R=new L({access:null,virtual:!1,name:null}),B=new D({ctor:function(){this.params=[],this.access=null,this.virtual=!1,this.name=null,this.method=null},build:function(e){var t=this;if(this.name===C)this._buildConstructor(e);else if(null!==e.parent&&e.parent.self[this.name]){var n=e.parent.self[this.name];e.self[this.name]=function(){var r=e.self.$super;e.self.$super=n;var i=t.method.apply(e.self,arguments);return void 0===r?delete e.self.$super:e.self.$super=r,i}}else e.self[this.name]=function(){return t.method.apply(e.self,arguments)};e.self[this.name]=e.self[this.name]},_buildConstructor:function(e){var t=this;e.self.ctor=function(){var n=e.self.$super,r=!1,i=!1;delete e.self.ctor,null!==e.template.parent&&e.template.parent.members.contains(C)&&(e.template.parent.members.get(C).params.length>0?(e.self.$super=function(){i=!0,e.parent.self.ctor.apply(void 0,arguments)},r=!0):e.parent.self.ctor());var o=e.self.$include,s=e.self.$merge;if(e.self.$include=function(n,r){t._merge(e,n,r,!0)},e.self.$merge=function(n,r){t._merge(e,n,r,!1)},t.method.apply(e.self,arguments),r){if(!i)throw j("InvalidOperationError","Constructor must call the parent constructor explicitly because it contains parameters.");void 0===n?delete e.self.$super:e.self.$super=n}void 0===o?delete e.self.$include:e.self.$include=o,void 0===s?delete e.self.$merge:e.self.$merge=s}},_merge:function(e,t,n,r){var i,o,s=0;if(n)if(a(n))for(o=n.length;o>s;s++)this._transclude(e,t,n[s],n[s],r);else{var u=f(n);for(o=u.length;o>s;s++)this._transclude(e,t,u[s],n[u[s]],r)}else for(i in t)this._transclude(e,t,i,i,r)},_transclude:function(e,t,n,r,i){var o=!1;if(e.derived&&(o=this._transclude(e.derived,t,n,r)),null===e.template.members.get(r)){var a=Object.getOwnPropertyDescriptor(t,n),u=!1,c=!1;if((void 0===a||"value"in a)&&(s(t[n])&&(e.self[r]=g(t[n],t),!o&&i&&(e.pub[r]=e.self[r]),c=!0),u=!0),!c){var l,f;(u||void 0!==a.get)&&(l=function(){return t[n]}),(u||void 0!==a.set)&&(f=function(e){t[n]=e}),w(e.self,r,{get:l,set:f}),!o&&i&&w(e.pub,r,{get:l,set:f})}}else o=!0;return o}}),G=new D({ctor:function(){this.name=null,this.access=null,this.value=null,this.virtual=!1,this.get=null,this.set=null},build:function(e){function t(t,r){return function(){var i={_super:e.self.$super,_value:e.self.$value};e.self.$super=r,e.self.$value=function(e){return arguments.length&&(n=e),n};var o=t.apply(e.self,arguments);return void 0===i._super?delete e.self.$super:e.self.$super=i._super,void 0===i._value?delete e.self.$value:e.self.$value=i._value,o}}var n=this.value,r=null!==e.parent?Object.getOwnPropertyDescriptor(e.parent.self,this.name):null;w(e.self,this.name,{get:this.get?t(this.get.method,r&&r.get?r.get:void 0):void 0,set:this.set?t(this.set.method,r&&r.set?r.set:void 0):void 0})}}),H=new L({parent:null,self:null,derived:null,template:null,pub:null}),N=new D({ctor:function(){this.tunnel=null,this.builder=null,this._checkTypeOurs=!1,this._typeCheckResult=!1,this._returnScope=!1,this._returnBase=!1,this._returnTemplate=!1},isTypeOurs:function(e){this._checkTypeOurs=!0,e();var t=this._typeCheckResult;return this._typeCheckResult=!1,this._checkTypeOurs=!1,t},createScope:function(e){this._returnScope=!0;var t=e.ctor();return this._returnScope=!1,t},createEmpty:function(e){this._returnBase=!0;var t=new e.ctor;return this._returnBase=!1,t},getTemplate:function(e){this._returnTemplate=!0;var t=e();return this._returnTemplate=!1,t},createType:function(){var e=this,t=null,n=new U,r=!0,i=function(){if(!e._returnBase){if(e._checkTypeOurs)return void(e._typeCheckResult=!0);if(e._returnScope){null===t&&(t=e._createSelf(n));var i=new H;return i.template=n,i.self=new t,i}if(e._returnTemplate)return n;if(r){var o;return r=!1,o=new n.ctor,e.builder.init(n,o,arguments,!0),r=!0,o}}};return n.ctor=i,n.members=new F,n},_createSelf:function(e){var t=this,n=function(){};return n.prototype=this.createEmpty(e),n.prototype.$pry=function(n){t.tunnel.open(e.ctor);var r=n&&n.__scope__?n.__scope__:null;return t.tunnel.close(),null!==r?r.self:n},n}}),U=new L({members:null,parent:null,ctor:null}),Y=new D({ctor:function(){this._value=null},open:function(e){this._value=e},close:function(){this._value=null},value:function(){return this._value}}),K=function(){function e(e){var r=n.createType();return t(r,e),r.ctor}function t(e,r){e.ctor.extend=function(r){var i=n.createType();return o.theParent(i,e.ctor),t(i,r),i.ctor},s(r)?o.theMembers(e,r.call(void 0)):o.theMembers(e,r),y(e.ctor)}var n=new N,r=new q,i=new Y,o=new I;r.system=n,r.tunnel=i,n.builder=r,n.tunnel=i,o.system=n;var a=function(){return e.apply(void 0,arguments)};return a.extend=function(e,r){var i=n.createType();return o.theParent(i,e),t(i,r),i.ctor},a}(),V=new L({create:function(){},inject:[],filter:[]}),J=new D({ctor:function(e){this._binding=e},asSingleton:function(){var e,t=this._binding.create,n=!1;return this._binding.create=function(){return n||(e=t.apply(void 0,arguments),n=!0),e},this},whenFor:function(e){if(!a(e)||!e.length)throw j("ArgumentError","Expected 'services' to be an array of string.");return this._binding.filter=e.slice(0),this}}),Q=new D({ctor:function(e,t){this._cookbook=e,this._handlers=[],this.missing=[],this.component=null;var n=t instanceof tt?t:this._cookbook.search(t);if(null!==n)this.component=this._prepare(n);else{var r=this;this._need(t,function(e){r.component=e})}},update:function(e){this.missing=[];for(var t=this._handlers.slice(0),n=0,r=t.length;r>n;n++)t[n](e)},_prepare:function(e){var t=this,n=new X(e),i=[n];return _(function(){var e=i.shift();return e.recipe.lazy||r(e.recipe.ingredients,function(n,r){var o=t._cookbook.search(n,e.recipe.name);if(o){var s=new X(o);s.parent=e,s.order=r,e.children[r]=s,t._checkForCircularDepenency(s),i.push(s)}else t._need(n,function(n){n.parent=e,n.order=r,e.children[r]=n,t._checkForCircularDepenency(n)})}),i.length}),n},_checkForCircularDepenency:function(e){for(var t=e.parent,n=e.recipe.name;t;){if(t.recipe.name===e.recipe.name)throw j("InvalidOperationError","Detected circular dependency to '"+e.recipe.name+"' through '"+n.recipe.name+"'.");n=t,t=t.parent}},_onUpdate:function(e,t){var n=this,r=e instanceof $,i=r||e instanceof E;if(r||i)e=e.value;else if(!c(e))throw j("InvalidOperationError","Expected 'service' to be a Lazy, Factory, or string. Perhaps there are multiple instances of this library running concurrently?");var o=function(s){var a=s[e];if(a){var u=n._cookbook.search(a);u?(u.name=e,u.factory=i,u.lazy=r,t(n._prepare(u))):n._need(a,t),n._handlers.splice(h(n._handlers,o),1)}};this._handlers.push(o)},_need:function(e,t){this.missing.push(e.value||e),this._onUpdate(e,t)}}),W=new D({ctor:function(e,t){this._cookbook=e,this._load=t},create:function(e,t){function n(){l._load(l._getNames(c.missing),{fail:function(e){if(t.yield)return function(){return void 0};throw e}}).then(i,u,!1)}function i(e){if(!a(e))return void f.reject(j("TypeError","Loaded successfully. Expected result to be an array."));var t={},i=!1;if(r(c.missing,function(n,r){var i=e[r];t[n]=!i||!/(function|array)/.test(o(i))||a(i)&&!s(i[i.length-1])?function(){return i}:i}),!i){try{c.update(t)}catch(u){return void f.reject(u)}c.missing.length?n():f.resolve(c.component)}}function u(e){f.reject(e)}var c,l=this,f=new S;try{return c=new Q(this._cookbook,e),c.missing.length?n():f.resolve(c.component),f.promise}catch(p){return f.reject(p),f.promise}},createFactory:function(e){if(e.recipe.lazy)return this._createLazy(e);for(var t=this,r=[],i=e,o=[i];o.length;){var s=o.shift();if(r.push(s),!s.recipe.lazy)for(var a=0,u=s.children.length;u>a;a++)o.push(s.children[a])}return r.reverse(),r.pop(),function(){for(var e=0,o=r.length;o>e;e++){var s=r[e];s.parent.prep[s.order]=s.recipe.factory?t.createFactory(s):s.recipe.create.apply(void 0,s.prep),s.prep=[]}var a=i.prep.concat(n(arguments));return i.prep=[],i.recipe.create.apply(void 0,a)}},_createLazy:function(e){var t=this,n=null;return function(){var r=arguments;return n?(new S).resolve(n.apply(void 0,r)).promise:t.create(e.recipe.name).then(function(e){return n=t.createFactory(e),n.apply(void 0,r)},function(e){throw e},!1)}},_getNames:function(e){return m(e,function(e){return e instanceof E?e=e.value:e instanceof $&&(e=e.value),e})}}),X=new D({ctor:function(e){this.parent=null,this.order=null,this.prep=[],this.recipe=e,this.children=[]}}),Z=new D({ctor:function(e){this._container=e},search:function(e,t){var n;return s(e)?new tt({create:e,ingredients:(e.$inject||[]).slice(0)}):a(e)?(e=e.slice(0),new tt({create:e.pop(),ingredients:e})):c(e)&&(n=this._lookup(e,t))?new tt({create:n.create,ingredients:n.inject.slice(0),name:e}):e instanceof E&&(n=this._lookup(e.value,t))?new tt({create:n.create,ingredients:n.inject.slice(0),name:e.value,factory:!0}):e instanceof $?(n=this._lookup(e.value,t)||{},new tt({create:n.create||null,ingredients:n.inject?n.inject.slice(0):null,name:e.value,factory:!0,lazy:!0})):null},_lookup:function(e,t){for(var n=this._container[e]||[],r=n.length-1;r>=0;r--)if(t){if(!n[r].filter.length||h(n[r].filter,t)>-1)break}else if(!n[r].filter.length)break;return n[r]||null}}),et=new K(function(){var t=new D({ctor:function(e,t){this._kernel=e,this._service=t},to:function(e){return new J(this._kernel.registerProvider(this._service,e))},toConstant:function(e){return new J(this._kernel.registerProvider(this._service,function(){return e}))}});return{ctor:function(e){this.container={},this.delegatingHandlers=[],this.moduleLoader=null,this.requireContext=null,this.detectModuleSupport(),this.cookbook=new Z(this.container),this.chef=new W(this.cookbook,this.chef_onLoad),e&&(this.pathPrefix=e)},pathPrefix:{get:null,set:function(e){if(null!==e&&!c(e))throw j("ArgumentError","Value must be a string or `null`.");this.$value(e)}},useRequire:function(e){return e([],function(){}),this.requireContext=e,this.$pub},bind:function(e){if(!e||!c(e))throw j("ArgumentError","Argument 'service' must have a value.");return new t(this,e)},unbind:function(e,t){t=t||[];var n=this.container[e]||[],r=t.length;if(r){for(var i,o,s=0,a=n.length;a>s;s++){if(n[s].filter)for(i=0;r>i;i++)for(o=h(n[s].filter,t[i]);o>-1;)n[s].filter.splice(o,1),o=h(n[s].filter,t[i]);n[s].filter.length||(n.splice(s,1),s--)}n.length||delete this.container[e]}else delete this.container[e];return this.$pub},get:function(e){return this.resolveTargetAsync(e,{args:this.shiftArgs(arguments)})},getOrYield:function(e){return this.resolveTargetAsync(e,{args:this.shiftArgs(arguments),"yield":!0})},resolve:function(e){return this.resolveTarget(e,{args:this.shiftArgs(arguments)})},resolveOrYield:function(e){return this.resolveTarget(e,{args:this.shiftArgs(arguments),"yield":!0})},register:function(e){return this.registerGraph("",e),this.$pub},delegate:function(e,t){return c(e)&&(e=new RegExp(e.replace(".","\\.").replace("*",".*"))),this.delegatingHandlers.push({pattern:e,handler:t}),this.$pub},require:function(e){return this.moduleLoader(e)},__shiftArgs:function(e){return e=n(e),e.shift(0),e},__resolveTarget:function(e,t){var n=new Q(this.cookbook,e);if(n.missing.length>0&&!t.yield)throw j("InvalidOperationError","The following services are missing: "+n.missing.join(", "));var i={};r(n.missing,function(e){i[e]=function(){return void 0}}),n.update(i);var o=this.chef.createFactory(n.component);return n.component.recipe.factory?o:o.apply(void 0,t.args)},__resolveTargetAsync:function(e,t){var n=this;return this.chef.create(e,t).then(function(e){var r=n.chef.createFactory(e);return e.recipe.factory?r:r.apply(void 0,t.args)},function(e){throw e})},__detectModuleSupport:function(){var t=this;void 0!==e.requirejs?(this.requireContext=e.requirejs,this.moduleLoader=function(e){var n=new S;return t.requireContext([e],n.resolve,n.reject),n.promise}):x||(this.moduleLoader=function(e){try{return(new S).resolve(require(e)).promise}catch(t){return(new S).reject(t).promise}})},__registerProvider:function(e,t){var n=null;if(a(t)){if(t=t.slice(0),n=new V({create:t.pop(),inject:t}),!s(n.create))throw j("ArgumentError","Expected last array element to be a function.")}else if(n=new V({create:t,inject:(t.$inject||[]).slice(0)}),!s(n.create))throw j("ArgumentError","Expected provider to be a function.");return this.container[e]=this.container[e]||[],this.container[e].push(n),n},__registerGraph:function(e,t){var n=this,r=""===e?"":e+".";i(t,function(e,t){v(e)?n.registerGraph(r+t,e):n.registerProvider(r+t,e)})},__resolvePath:function(e){return this.pathPrefix?d(this.pathPrefix,e):e},__chef_onLoad:function(e,t){var n=this,i=[];return r(e,function(e){var o=!1;r(n.delegatingHandlers,function(t){if(t.pattern.test(e)){var n=t.handler(e);if(n)return i.push(n),o=!0,!1}}),o||i.push((null===n.moduleLoader?(new S).reject(new j("InvalidOperationError","The service '"+e+"' has not been registered.")).promise:n.moduleLoader(n.resolvePath(e.replace(/\./g,"/")))).then(void 0,function(n){if(t.fail)return t.fail(n,e);throw n}))}),S.when(i)}}}),tt=new L({create:function(){},ingredients:[],name:null,factory:!1,lazy:!1}),nt={Class:K,Event:I.Event,extend:K.extend,error:j,of:o,Task:S,Kernel:et,Factory:E,Lazy:$,ns:b,setImmediate:A,merge:k};"undefined"!=typeof module&&module.exports?module.exports=nt:"function"==typeof define&&define.amd?define(function(){return nt}):window.type=nt}("undefined"==typeof global?window:global);