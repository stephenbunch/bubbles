/*! typejs v0.1.0 */
!function(a){"use strict";function b(a){if(g(a))return a;var b=[];return d(a,function(a){b.push(a)}),b}function c(a,b){if(Array.prototype.forEach)a.forEach(b);else for(var c=0,d=a.length;d>c&&b.call(void 0,a[c],c)!==!1;c++);}function d(a,b){for(var c in a)if(j(a,c)&&b.call(void 0,a[c],c)===!1)break}function e(a){return null===a?"null":void 0===a?"undefined":Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}function f(a){return"function"===e(a)}function g(a){return"array"===e(a)}function h(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function i(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)j(a,c)&&b.push(c);return b}function j(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function k(a,b){if(a.indexOf)return a.indexOf(b);var d=-1;return c(a,function(a,c){return a===b?(d=c,!1):void 0}),d}function l(a){if("object"!==e(a)||a.nodeType||"window"===e(a))return!1;try{if(a.constructor&&!j(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function m(a,d,e){if(a=b(a),Array.prototype.map)return a.map(d,e);var f=[];c(a,function(a,b){f.push(d.call(e,a,b))})}function n(){return m(arguments,function(a,b){return 0===b?a.replace(/\/$/,""):a.replace(/(^\/|\/$)/g,"")}).join("/")}function o(a,b){return function(){return a.apply(b,arguments)}}function p(a,b){return b?a():void 0}function q(a,b,c){if(void 0===c.enumerable&&(c.enumerable=!0),v&&delete c.enumerable,void 0===c.configurable&&(c.configurable=!0),v&&j(a,b)&&delete a[b],!Object.defineProperty)throw u("InitializationError","JavaScript properties are not supported by this browser.");Object.defineProperty(a,b,c)}function r(a){for(;;)if(!a.call(void 0))break}function s(a){return this instanceof s?(this.value=a,void 0):new s(a)}function t(a){return this instanceof t?(this.value=a,void 0):new t(a)}var u=function(){function a(a,c){if(!b[a]){var d=function(a){this.message=a};d.prototype=new b.Error,d.prototype.name=a,b[a]=d}return c?new b[a](c):b[a]}var b={Error:Error,TypeError:TypeError};return function(){return a.apply(void 0,arguments)}}(),v=function(){try{return Object.defineProperty({},"x",{}),!1}catch(a){return!0}}(),w="public",x="private",y="protected",z="ctor",A=function(){if(a.setImmediate)return a.setImmediate;var b=[],c="zero-timeout-message",d=function(a){b.push(a),window.postMessage(c,"*")},e=function(a){a.source===window&&a.data===c&&(a.stopPropagation(),b.length>0&&b.shift()())};return window.addEventListener("message",e,!0),d}(),B=function(a){a=a||{},f(a)&&(a=a());var b="default",c=function(){if("new"===b)return b="void",new d;if("void"!==b){b="new";var a=d();b="default";var c=a.ctor.apply(a,arguments);return f(c)||g(c)||"object"===e(c)?c:a}},d=function(){return c.apply(void 0,arguments)};return a.ctor||(a.ctor=function(){}),d.prototype=a,d},C=function(){function a(a,b,c){for(var d=[{src:c,tmpl:b,dest:a}];d.length;){var f=d.shift();if(f.array)for(var g=0,h=f.array.length;h>g;g++)switch(e(f.array[g])){case"object":var i=f.array[g];f.array[g]={},d.push({tmpl:i,dest:f.array[g]});break;case"array":f.array[g]=f.array[g].slice(0),d.push({array:f.array[g]})}else for(var j in f.tmpl)if(void 0!==f.src[j])f.dest[j]=f.src[j];else switch(e(f.tmpl[j])){case"object":f.dest[j]={},d.push({tmpl:f.tmpl[j],dest:f.dest[j]});break;case"array":f.dest[j]=f.tmpl[j].slice(0),d.push({array:f.dest[j]});break;default:f.dest[j]=f.tmpl[j]}}}return function(b){var c="default",d=function(d){if("new"===c)return c="void",new e;if("void"!==c){c="new";var f=e();return c="default",a(f,b,d||{}),f}},e=function(){return d.apply(void 0,arguments)};return e}}(),D=new B({ctor:function(){this.keys=[],this.values=[]},add:function(a,b){k(this.keys,a)>-1||(this.keys.push(a),this.values.push(b))},remove:function(a){var b=k(this.keys,a);b>-1&&(this.keys.splice(b,1),this.values.splice(b,1))},get:function(a){var b=k(this.keys,a);return b>-1?this.values[b]:null},set:function(a,b){var c=k(this.keys,a);c>-1&&(this.values[c]=b)},contains:function(a){return k(this.keys,a)>-1}}),E=new B(function(){function a(b,c){if(c===b)return b.reject(new TypeError("2.3.1 A promise returned from onFulfilled cannot refer to itself.")),!0;if(c){var d,e=!1;try{j(c,"then")&&(d=c.then)}catch(g){return b.reject(g),!0}if(f(d)){try{d.call(c,function(c){e||(e=!0,a(b,c)||b.resolve(c))},function(a){e||(e=!0,b.reject(a))})}catch(g){e||b.reject(g)}return!0}}}function b(b,c,e){var g=function(g,h){var i,j=g===d?c:e;if(!f(j))return g===d?b.resolve(h):b.reject(h),void 0;try{i=j.call(void 0,h)}catch(k){return b.reject(k),void 0}a(b,i)||b.resolve(i)};return function(){var a=arguments;A(function(){g.apply(void 0,a)})}}var c="pending",d="fulfilled",e="rejected";return{ctor:function(a){function f(a,b){if(h===c){h=a,j=b;for(var d=0,e=i.length;e>d;d++)i[d](h,j);i=[]}}var g=this,h=c,i=[],j=null;this.then=function(a,d){var e=new E,f=b(e,a,d);return h===c?i.push(f):f(h,j),e},this.resolve=function(a){return f(d,a),this},this.reject=function(a){return f(e,a),this},this.promise={then:this.then},a&&A(function(){a.call(void 0,g.resolve,g.reject)})},splat:function(a,b){return this.then(function(b){return a.apply(void 0,b)},b)}}});E.when=function(a){a=g(a)?a:b(arguments);var d=new E,e=0,f=[];return c(a,function(b,c){b.then(function(b){f[c]=b,++e===a.length&&d.resolve(f)},function(a){d.reject(a)})}),a.length||d.resolve([]),d.promise};var F,G=new C({access:null,method:null,callsuper:!1}),H=new B({ctor:function(){this.controller=null,this.tunnel=null},init:function(a,b,c,d){var e=this,f=this.controller.createScope(a);return q(f.self,"_pub",{get:function(){return b}}),this._build(f),this._expose(f,b),q(b,"__scope__",{enumerable:!1,get:function(){return e.tunnel.value()===a.ctor?f.self:void 0}}),d&&f.self.ctor.apply(f.self,c),p(function(){function b(c){null!==c.template.parent&&b(c.parent);for(var d=0,e=c.template.members.values.length;e>d;d++)c.template.members.values[d]instanceof M&&c.self[a.members.keys[d]]()}b(f)}),f},_build:function(a){if(null!==a.template.parent){var b=a.template.parent.members.get(z);if(null!==b&&b.params.length>0){var c=a.template.members.get(z);if(null===c||c.callsuper===!1)throw u("InitializationError","Base constructor contains parameters and must be called explicitly.")}a.parent=this.controller.createScope(a.template.parent),a.parent.self._pub=a.self._pub,this._build(a.parent)}null!==a.template.parent&&this._proxy(a.parent,a);for(var d=0,e=a.template.members.values.length;e>d;d++)a.template.members.values[d].build(a);if(!a.self.ctor){var f=new M;f.name=z,f.access=x,f.method=function(){},f.build(a)}},_proxy:function(a,b){c(a.template.members.values,function(c){if(c.access!==x&&!b.template.members.get(c.name))if(c instanceof M||c instanceof K)b.self[c.name]=a.self[c.name];else if(c instanceof N){var d={};c.get&&c.get.access!==x&&(d.get=function(){return a.self[c.name]}),c.set&&c.set.access!==x&&(d.set=function(b){a.self[c.name]=b}),q(b.self,c.name,d)}})},_expose:function(a,b){null!==a.template.parent&&this._expose(a.parent,b),c(a.template.members.values,function(c){if(c.access===w)if(c instanceof M)b[c.name]=a.self[c.name];else if(c instanceof K)q(b,c.name,{get:function(){return a.self[c.name]._pub},set:function(b){a.self[c.name]=b}});else if(c instanceof N){var d={};c.get&&c.get.access===w&&(d.get=function(){return a.self[c.name]}),c.set&&c.set.access===w&&(d.set=function(b){a.self[c.name]=b}),q(b,c.name,d)}})}}),I=new B(function(){function a(b,c){var d=b.prototype;d.constructor.prototype!==d&&a(d.constructor,c);for(var e in d)j(d,e)&&(c[e]=d[e])}function b(){var a,b=document.createElement();for(a in b)j(b,a)&&c(b,a);return b}function c(a,b){var c;Object.defineProperty(a,b,{configurable:!0,get:function(){return c},set:function(a){c=a}})}var d=function(a){return function(){return a.apply(void 0,arguments)}};return{ctor:function(){this.tunnel=null,this.builder=null,this._checkTypeOurs=!1,this._typeCheckResult=!1,this._returnScope=!1,this._returnBase=!1,this._returnTemplate=!1},isTypeOurs:function(a){this._checkTypeOurs=!0,a();var b=this._typeCheckResult;return this._typeCheckResult=!1,this._checkTypeOurs=!1,b},createScope:function(a){this._returnScope=!0;var b=a.ctor();return this._returnScope=!1,b},createEmpty:function(a){this._returnBase=!0;var b=new a.ctor;return this._returnBase=!1,b},getTemplate:function(a){this._returnTemplate=!0;var b=a();return this._returnTemplate=!1,b},createTemplate:function(){var c=this,e=null,f=new P,g=!0,h=function(){if(!c._returnBase){if(c._checkTypeOurs)return c._typeCheckResult=!0,void 0;if(c._returnScope){null===e&&(e=c._createSelf(f));var d=new O;return d.template=f,v?(d.self=b(),a(e,d.self)):d.self=new e,d}if(c._returnTemplate)return f;if(g){var h;return g=!1,v?(h=b(),a(f.ctor,h)):h=new f.ctor,c.builder.init(f,h,arguments,!0),g=!0,h}}};return f.ctor=d(h),f.members=new D,f},_createSelf:function(a){var b=this,c=function(){};return c.prototype=this.createEmpty(a),c.prototype._pry=function(c){b.tunnel.open(a.ctor);var d=c&&c.__scope__?c.__scope__:null;return b.tunnel.close(),d||c},c}}}),J=new B(function(){function a(a){var b=a.substr(0,2),c=m[b]||m[a[0]]||w,d=n[b]||n[a[0]]||!1;return a=a.substr(o[b]||o[a[0]]||0),a===z&&(c=x,d=!1),new L({access:c,virtual:d,name:a})}function b(a,b){if(d(a,b.name))throw u("DefinitionError","Member '"+b.name+"' is already defined.");if(b.access!==x&&null!==a.parent){var c=a.parent.members.get(b.name);if(null!==c&&c.access!==b.access)throw u("DefinitionError","Cannot change access modifier of member '"+b.name+"' from "+c.access+" to "+b.access+".")}}function d(a,b,c){var e=a.members.get(b);return null===e||c&&e.access===x||c&&!(e instanceof K)&&e.virtual!==!1?null!==a.parent?d(a.parent,b,!0):!1:!0}function j(a){var b=[],c=a.toString().match(/^function\s*\(([^())]+)\)/);if(null!==c)for(var d=c[1].split(","),e=0,f=d.length;f>e;e++)b.push(h(d[e]));var g=new M;return g.method=a,g.params=b,g.callsuper=r.test(a),g}function k(b,c,d){var g=new N;g.access=c.access,g.name=c.name,g.virtual=c.virtual,"object"!==e(d)?(g.value=d,d={}):g.value=d.value,void 0===g.value&&(g.value=null);for(var h=i(d),j=0,k=h.length;k>j;j++){var m=d[h[j]],n=a(h[j].toLowerCase());if("get"===n.name||"set"===n.name){if(n.virtual)throw u("DefinitionError","Property '"+c.name+"' cannot have virtual accessors.");if(null!==m&&!f(m))throw u("TypeError","The "+n.name+" accessor for property '"+c.name+"' must be a function or null (uses default implementation.)");g[n.name]=new G({access:n.access===w?c.access:n.access,method:m})}}return g.get||g.set||(g.get=new G({access:c.access}),g.set=new G({access:c.access})),null!==g.get&&(null===g.get.method&&(g.get.method=function(){return this._value()}),g.get.callsuper=r.test(g.get.method)),null!==g.set&&(null===g.set.method&&(g.set.method=function(a){this._value(a)}),g.set.callsuper=r.test(g.set.method)),l(b,g),g}function l(a,b){for(var c=["get","set"],d=0,e=0,f=c.length;f>e;e++){var g=c[e],h=b[g];if(null!==h){var i=null!==a.parent?a.parent.members.get(b.name):null;if(null!==i&&i.access!==x&&null===i[g])throw u("DefinitionError","Cannot change read/write definition of property '"+b.name+"'.");if(q[h.access]<q[b.access])throw u("DefinitionError","The "+g+" accessor of the property '"+b.name+"' cannot have a higher visibility than the property itself.");if(h.access!==b.access&&d++,null!==i&&h.access!==i.access)throw u("DefinitionError","Cannot change access modifier of '"+g+"' accessor for property '"+b.name+"' from "+i.access+" to "+h.access+".")}}if(2===d)throw u("DefinitionError","Cannot set access modifers for both accessors of the property '"+b.name+"'.")}var m={__:x,_:y},n={$:!0,_$:!0},o={__:2,_$:2,_:1,$:1},q={};q[w]=1,q[y]=2,q[x]=3;var r=/xyz/.test(function(){xyz=0})?/\b_super\b/:/.*/;return{ctor:function(){this.controller=null},defineParent:function(a,b){if(a.members.keys.length>0)throw u("DefinitionError","Cannot change the parent type after members have been defined.");if(!f(b))throw u("TypeError","Parent type must be a function.");if(this.controller.isTypeOurs(b)){for(var c=this.controller.getTemplate(b),d=c;d;){if(d===a)throw u("DefinitionError","Cannot inherit from "+(c===a?"self":"derived type")+".");d=d.parent}a.parent=c,a.ctor.prototype=this.controller.createEmpty(c)}else a.ctor.prototype=new b},defineMembers:function(e,h){c(i(h||{}),function(c){var i=a(c),l=h[c];if(b(e,i),!p(function(){return d(e,i.name)})){if(i.name===z&&(g(l)&&(e.ctor.$inject=l,l=l.pop()),!f(l)))throw u("TypeError","Member '"+z+"' must be a function.");var m=f(l)?j(l):k(e,i,l);if(i.name===z&&!m.callsuper&&null!==e.parent){var n=e.parent.members.get(z);if(null!==n&&n.params.length>0)throw u("DefinitionError","Constructor must call the parent constructor explicitly because it contains parameters.")}m.name=i.name,m.access=i.access,m.virtual=i.virtual,e.members.add(i.name,m)}})},defineEvents:function(c,d){for(var e=0,f=d.length;f>e;e++){var g=a(d[e]);if(b(c,g),g.name===z)throw u("DefinitionError","Event cannot be named 'ctor'.");if(g.virtual)throw u("DefinitionError","Events cannot be virtual.");var h=new K;h.name=g.name,h.access=g.access,c.members.add(g.name,h)}}}}),K=new B(function(){var a=function(){var a,b=function(a,b){return a=o(a,b),a.valueOf=c,a};b.operands=[],b.reset=function(){b.operands=[],Function.prototype.valueOf=a};var c=function(){return 2===b.operands.length&&b.operands.splice(0,1),b.operands.push(this),Function.prototype.valueOf!==c&&(a=Function.prototype.valueOf,Function.prototype.valueOf=c),3};return b}();return{ctor:function(){this.name=null,this.access=null},build:function(b){function c(a){f.push(a)}function d(a){var b=k(f,a);b>-1&&f.splice(b,1)}var e=this,f=[],g=new a(function(){for(var a=0,b=f.length;b>a;a++)f[a].apply(void 0,arguments)});g._pub=new a(function(){throw u("InvalidOperationError","The event '"+e.name+"' cannot be raised except from within its own type.")}),q(b.self,this.name,{get:function(){return g},set:function(b){if(2===a.operands.length&&(a.operands[0]===g||a.operands[0]===g._pub)){var e=a.operands[1];6===b?c(e):0===b&&d(e)}a.reset()}})}}}),L=new C({access:null,virtual:!1,name:null}),M=new B({ctor:function(){this.callsuper=!1,this.params=[],this.access=null,this.virtual=!1,this.name=null,this.method=null},build:function(a){var b=this;if(this.name===z)this._buildConstructor(a);else if(null!==a.parent&&a.parent.self[this.name]){var c=a.parent.self[this.name];a.self[this.name]=function(){var d=a.self._super;a.self._super=c;var e=b.method.apply(a.self,arguments);return void 0===d?delete a.self._super:a.self._super=d,e}}else a.self[this.name]=function(){return b.method.apply(a.self,arguments)};a.self[this.name]=a.self[this.name]},_buildConstructor:function(a){var b=this;a.self.ctor=function(){var c=a.self._super;delete a.self.ctor,null!==a.template.parent&&a.template.parent.members.contains(z)&&(a.template.parent.members.get(z).params.length>0?a.self._super=a.parent.self.ctor:a.parent.self.ctor()),b.method.apply(a.self,arguments),void 0===c?delete a.self._super:a.self._super=c}}}),N=new B({ctor:function(){this.name=null,this.access=null,this.value=null,this.virtual=!1,this.get=null,this.set=null},build:function(a){function b(b,c){return function(){var e={_super:a.self._super,_value:a.self._value};a.self._super=c,a.self._value=function(a){return arguments.length&&(d=a),d};var f=b.apply(a.self,arguments);return void 0===e._super?delete a.self._super:a.self._super=e._super,void 0===e._value?delete a.self._value:a.self._value=e._value,f}}var c=this,d=this.value,e={};this.get&&(e.get=b(this.get.method,null===a.parent?null:function(){return a.parent.self[c.name]})),this.set&&(e.set=b(this.set.method,null===a.parent?null:function(b){a.parent.self[c.name]=b})),q(a.self,this.name,e)}}),O=new C({parent:null,self:null,mixins:[],template:null}),P=new C({members:null,parent:null,ctor:null}),Q=new B({ctor:function(){this._value=null},open:function(a){this._value=a},close:function(){this._value=null},value:function(){return this._value}}),R=void 0,S=new B({ctor:function(){this._pending={},this._cache={},this._browser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),this._last=null,F=o(this._onTypeDefined,this)},fetch:function(a){var b=new E;if(this._browser){var c=a.url;if(c=/^\/\//.test(c)?window.location.protocol+c:/^\//.test(c)?window.location.protocol+"//"+window.location.host+c:window.location.protocol+"//"+window.location.host+window.location.pathname+c,this._cache[c])b.resolve(this._cache[c]);else if(this._pending[c])this._pending[c].bind(b);else{var d=document.createElement("script");d.src=c,d.addEventListener("error",function(){b.reject()},!1),document.body.appendChild(d),this._pending[c]=b}}else this._last=b,require(a.url);return b.promise},_onTypeDefined:function(a){if(this._browser){var b=document.getElementsByTagName("script"),c=b[b.length-1].src;if(this._pending[c]){this._cache[c]=a;var d=this._pending[c];delete this._pending[c],setTimeout(function(){d.resolve(a)})}}else null!==this._last&&(this._last.resolve(a),this._last=null)}}),T=function(){var a=new H,c=new I,d=new Q,e=new J;a.controller=c,a.tunnel=d,c.builder=a,c.tunnel=d,e.controller=c;var g=function(){var a=c.createTemplate();return a.ctor.extend=function(){var d=c.createTemplate();return e.defineParent(d,a.ctor),h(d,b(arguments)),d.ctor},h(a,b(arguments)),a.ctor},h=function(a,c){if(f(c[0])){var d=function(c,d){return function(){return c.apply(e,[a].concat(b(arguments))),d}},g={extend:d(e.defineParent,g),include:d(e.defineMixins,g),events:d(e.defineEvents,g),members:d(e.defineMembers,g)};c[0].call(g)}else 2===c.length&&(c[0].extend&&e.defineParent(a,c[0].extend),c[0].include&&e.defineMixins(a,c[0].include),c[0].events&&e.defineEvents(a,c[0].events)),c.length>0&&e.defineMembers(a,c[1]||c[0]);F&&F(a.ctor),p(a.ctor)};return function(){return g.apply(void 0,arguments)}}(),U=new C({create:function(){},inject:[],filter:[]}),V=new T({ctor:function(a){this.binding=a},asSingleton:function(){var a,b=this.binding.create,c=!1;return this.binding.create=function(){return c||(a=b.apply(void 0,arguments),c=!0),a},this._pub},whenFor:function(a){if(!g(a)||!a.length)throw u("ArgumentError","Expected 'services' to be an array of string.");return this.binding.filter=a.slice(0),this._pub}}),W=new B({ctor:function(a,b){this._cookbook=a,this._handlers=[],this.missing=[],this.component=null;var c=b instanceof _?b:this._cookbook.search(b);if(null!==c)this.component=this._prepare(c);else{this.missing.push(b);var d=this;this._onUpdate(b,function(a){d.component=a})}},update:function(a){this.missing.splice(0);for(var b=this._handlers.slice(0),c=0,d=b.length;d>c;c++)b[c](a)},_prepare:function(a){var b=this,d=new Y(a),e=[d];return r(function(){var a=e.shift();return a.recipe.lazy||c(a.recipe.ingredients,function(c,d){var f=b._cookbook.search(c,a.recipe.name);if(f){var g=new Y(f);g.parent=a,g.order=d,a.children[d]=g,e.push(g)}else b.missing.push(c),b._onUpdate(c,function(b){b.parent=a,b.order=d,a.children[d]=b})}),e.length}),d},_onUpdate:function(a,b){var c=this,d=a instanceof t,e=d||a instanceof s;(d||e)&&(a=a.value);var f=function(g){var h=g[a];if(h){var i=c._cookbook.search(h);i?(i.factory=e,i.lazy=d,b(c._prepare(i))):(c.missing.push(h),c._onUpdate(h,b)),c._handlers.splice(k(c._handlers,f),1)}};this._handlers.push(f)}}),X=new B({ctor:function(a,b){this._cookbook=a,this._loader=b},create:function(a){function b(){h=i._getRelativePaths(k.missing),i._loader()(h).then(c,d,!1)}function c(a){for(var c={},d=0,i=k.missing.length;i>d;d++){var l=k.missing[d].value||k.missing[d],m=a[d];if(!m||!/(string|function|array)/.test(e(m)))return j.reject(new TypeError("Module '"+h[d]+"' loaded successfully. Failed to resolve service '"+l+"'. Expected service to be a string, array, or function. Found '"+(m&&m.toString?m.toString():e(m))+"' instead.")),!1;if(g(m)&&!f(m[m.length-1]))return m=m[m.length-1],j.reject(new TypeError("Module '"+h[d]+"' loaded successfully. Failed to resolve service '"+l+"'. Found array. Expected last element to be a function. Found '"+(m&&m.toString?m.toString():e(m))+"' instead.")),!1;c[l]=a[d]}"rejected"!==j.state&&(k.update(c),k.missing.length?b():j.resolve(k.component))}function d(a){j.reject(a)}var h,i=this,j=new E,k=new W(this._cookbook,a);return k.missing.length?this._loader()?b():j.reject(new u("InvalidOperationError","Service(s) "+m(k.missing,function(a){return"'"+a+"'"}).join(", ")+" have not been registered.")):j.resolve(k.component),j.promise},createFactory:function(a){if(a.recipe.lazy)return this._createLazy(a);for(var c=this,d=[],e=a,f=[e];f.length;){var g=f.shift();if(d.push(g),!g.recipe.lazy)for(var h=0,i=g.children.length;i>h;h++)f.push(g.children[h])}return d.reverse(),d.pop(),function(){for(var a=0,f=d.length;f>a;a++){var g=d[a];g.parent.prep[g.order]=g.recipe.factory?c.createFactory(g):g.recipe.create.apply(void 0,g.prep),g.prep=[]}var h=e.prep.concat(b(arguments));return e.prep=[],e.recipe.create.apply(void 0,h)}},_createLazy:function(a){var b=this,c=null;return function(){var d=arguments;return c?(new E).resolve(c.apply(void 0,d)).promise:b.create(a.recipe.name).then(function(a){return c=b.createFactory(a),c.apply(void 0,d)},function(a){throw a},!1)}},_getRelativePaths:function(a){return m(a,function(a){return a instanceof s?a=a.value:a instanceof t&&(a=a.value),a.replace(/\./g,"/")})}}),Y=new B({ctor:function(a){this.parent=null,this.order=null,this.prep=[],this.recipe=a,this.children=[]}}),Z=new B({ctor:function(a){this._container=a},search:function(a,b){var c;return f(a)?new _({create:a,ingredients:(a.$inject||[]).slice(0)}):g(a)?(a=a.slice(0),new _({create:a.pop(),ingredients:a})):"string"===e(a)&&(c=this._lookup(a,b))?new _({create:c.create,ingredients:c.inject.slice(0),name:a}):a instanceof s&&(c=this._lookup(a.value,b))?new _({create:c.create,ingredients:c.inject.slice(0),name:a.value,factory:!0}):a instanceof t?(c=this._lookup(a.value,b)||{},new _({create:c.create||null,ingredients:c.inject?c.inject.slice(0):null,name:a.value,factory:!0,lazy:!0})):null},_lookup:function(a,b){for(var c=this._container[a]||[],d=c.length-1;d>=0;d--)if(b){if(!c[d].filter.length||k(c[d].filter,b)>-1)break}else if(!c[d].filter.length)break;return c[d]||null}}),$=new T(function(){var a=new T({ctor:function(a,b){this.kernel=a,this.service=b},to:function(a){return new V(this.kernel.registerProvider(this.service,a))},toConstant:function(a){return new V(this.kernel.registerProvider(this.service,function(){return a}))}}),c=new S;this.members({ctor:function(){this.container={},this.require=null;var a=this,b=new Z(this.container);this.chef=new X(b,function(){return a.require})},bind:function(b){if(!b||"string"!==e(b))throw u("ArgumentError","Argument 'service' must have a value.");return new a(this,b)},unbind:function(a,b){b=b||[];var c=this.container[a]||[],d=b.length;if(d){for(var e,f,g=0,h=c.length;h>g;g++){if(c[g].filter)for(e=0;d>e;e++)for(f=k(c[g].filter,b[e]);f>-1;)c[g].filter.splice(f,1),f=k(c[g].filter,b[e]);c[g].filter.length||(c.splice(g,1),g--)}c.length||delete this.container[a]}else delete this.container[a];return this._pub},get:function(a,c){var d=this;return c=b(arguments),c.shift(0),this.chef.create(a).then(function(a){var b=d.chef.createFactory(a);return a.recipe.factory?b:b.apply(void 0,c)},function(a){throw a})},register:function(a){return this.registerGraph("",a),this._pub},autoLoad:function(a){if(a===!1)this.require=null;else{var b;f(a)?b=a:("string"===e(a)&&(a={baseUrl:a}),a={baseUrl:a.baseUrl||"",waitSeconds:0===a.waitSeconds||a.waitSeconds?a.waitSeconds:7,urlArgs:a.urlArgs||"",scriptType:a.scriptType||"text/javascript"},b=function(b){var d=n(a.baseUrl,b);return/\.js$/.test(d)||(d+=".js"),c.fetch({url:d,timeout:1e3*a.waitSeconds,query:a.urlArgs,scriptType:a.scriptType})}),this.require=function(a){return E.when(m(a,function(a){var c=b(a);if(!c||!f(c.then))throw u("TypeError","Service loader must return a promise.");return c}))}}},__registerProvider:function(a,b){var c=null;if(g(b)){if(b=b.slice(0),c=new U({create:b.pop(),inject:b}),!f(c.create))throw u("ArgumentError","Expected last array element to be a function.")}else if(c=new U({create:b,inject:(b.$inject||[]).slice(0)}),!f(c.create))throw u("ArgumentError","Expected provider to be a function.");return this.container[a]=this.container[a]||[],this.container[a].push(c),c},__registerGraph:function(a,b){var c=this,e=""===a?"":a+".";d(b,function(a,b){l(a)?c.registerGraph(e+b,a):c.registerProvider(e+b,a)})}})}),_=new C({create:function(){},ingredients:[],name:null,factory:!1,lazy:!1}),ab={def:T,error:u,of:e,Task:E,Kernel:$,Factory:s,Lazy:t,proxy:o,module:R};"undefined"!=typeof module&&module.exports?module.exports=ab:window.type=ab}("undefined"==typeof global?window:global);